<!doctype html>
<html lang="zh-CN" data-theme="light">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="generator" content="VuePress 2.0.0-rc.20" />
    <meta name="theme" content="VuePress Theme Hope 2.0.0-rc.73" />
    <style>
      :root {
        --vp-c-bg: #fff;
      }

      [data-theme="dark"] {
        --vp-c-bg: #1b1b1f;
      }

      html,
      body {
        background: var(--vp-c-bg);
      }
    </style>
    <script>
      const userMode = localStorage.getItem("vuepress-theme-hope-scheme");
      const systemDarkMode =
        window.matchMedia &&
        window.matchMedia("(prefers-color-scheme: dark)").matches;

      if (userMode === "dark" || (userMode !== "light" && systemDarkMode)) {
        document.documentElement.setAttribute("data-theme", "dark");
      }
    </script>
    <meta property="og:url" content="https://LincDocs.github.io/trpl-zh-cn/ch17-05-traits-for-async.html"><meta property="og:site_name" content="trpl-zh-cn"><meta property="og:description" content="深入理解 async 相关的 traits ch17-05-traits-for-async.md commit 56ec353290429e6547109e88afea4de027b0f1a9 贯穿本章，我们通过多种方式使用了 Future、Pin、Unpin、Stream 和 StreamExt trait。但是直到目前为止，我们避免过多地了解它们..."><meta property="og:type" content="article"><meta property="og:locale" content="zh-CN"><script type="application/ld+json">{"@context":"https://schema.org","@type":"Article","headline":"","image":[""],"dateModified":null,"author":[{"@type":"Person","name":"LincDocs","url":"https://github.com/LincDocs/trpl-zh-cn/"}]}</script><title>ch17-05-traits-for-async | trpl-zh-cn</title><meta name="description" content="深入理解 async 相关的 traits ch17-05-traits-for-async.md commit 56ec353290429e6547109e88afea4de027b0f1a9 贯穿本章，我们通过多种方式使用了 Future、Pin、Unpin、Stream 和 StreamExt trait。但是直到目前为止，我们避免过多地了解它们...">
    <link rel="preload" href="/trpl-zh-cn/assets/style-DvbatUwB.css" as="style"><link rel="stylesheet" href="/trpl-zh-cn/assets/style-DvbatUwB.css">
    <link rel="modulepreload" href="/trpl-zh-cn/assets/app-oyO3eSzo.js"><link rel="modulepreload" href="/trpl-zh-cn/assets/ch17-05-traits-for-async.html-D28r9dmA.js">
    <link rel="prefetch" href="/trpl-zh-cn/assets/PREFACE.html-RVdFlQMP.js" as="script"><link rel="prefetch" href="/trpl-zh-cn/assets/index.html-ImDLv0xW.js" as="script"><link rel="prefetch" href="/trpl-zh-cn/assets/SUMMARY.html-vOfSR6Xv.js" as="script"><link rel="prefetch" href="/trpl-zh-cn/assets/appendix-00.html-CJ1F_HGx.js" as="script"><link rel="prefetch" href="/trpl-zh-cn/assets/appendix-01-keywords.html-BNyRzL8K.js" as="script"><link rel="prefetch" href="/trpl-zh-cn/assets/appendix-02-operators.html-c8dQUTyy.js" as="script"><link rel="prefetch" href="/trpl-zh-cn/assets/appendix-03-derivable-traits.html-DF28DrmE.js" as="script"><link rel="prefetch" href="/trpl-zh-cn/assets/appendix-04-useful-development-tools.html-xjirrWNS.js" as="script"><link rel="prefetch" href="/trpl-zh-cn/assets/appendix-05-editions.html-C3f57NGa.js" as="script"><link rel="prefetch" href="/trpl-zh-cn/assets/appendix-06-translation.html-CMUgkd8C.js" as="script"><link rel="prefetch" href="/trpl-zh-cn/assets/appendix-07-nightly-rust.html-PfArP5n6.js" as="script"><link rel="prefetch" href="/trpl-zh-cn/assets/ch00-00-introduction.html-cGLEdZRO.js" as="script"><link rel="prefetch" href="/trpl-zh-cn/assets/ch01-00-getting-started.html-BQdPxq_v.js" as="script"><link rel="prefetch" href="/trpl-zh-cn/assets/ch01-01-installation.html-Hr1xJWf-.js" as="script"><link rel="prefetch" href="/trpl-zh-cn/assets/ch01-02-hello-world.html-CustoIwN.js" as="script"><link rel="prefetch" href="/trpl-zh-cn/assets/ch01-03-hello-cargo.html-7TmW16qA.js" as="script"><link rel="prefetch" href="/trpl-zh-cn/assets/ch02-00-guessing-game-tutorial.html-ChdAP1wr.js" as="script"><link rel="prefetch" href="/trpl-zh-cn/assets/ch03-00-common-programming-concepts.html-DVsFFl4C.js" as="script"><link rel="prefetch" href="/trpl-zh-cn/assets/ch03-01-variables-and-mutability.html-DiZeMC0q.js" as="script"><link rel="prefetch" href="/trpl-zh-cn/assets/ch03-02-data-types.html-C2hBVlox.js" as="script"><link rel="prefetch" href="/trpl-zh-cn/assets/ch03-03-how-functions-work.html-qRRuMCZe.js" as="script"><link rel="prefetch" href="/trpl-zh-cn/assets/ch03-04-comments.html-BLKeQkxx.js" as="script"><link rel="prefetch" href="/trpl-zh-cn/assets/ch03-05-control-flow.html-DrFU__vi.js" as="script"><link rel="prefetch" href="/trpl-zh-cn/assets/ch04-00-understanding-ownership.html-CRWDiXQa.js" as="script"><link rel="prefetch" href="/trpl-zh-cn/assets/ch04-01-what-is-ownership.html-Cx8R6RCJ.js" as="script"><link rel="prefetch" href="/trpl-zh-cn/assets/ch04-02-references-and-borrowing.html-DqGUSv17.js" as="script"><link rel="prefetch" href="/trpl-zh-cn/assets/ch04-03-slices.html-DHHXHxWA.js" as="script"><link rel="prefetch" href="/trpl-zh-cn/assets/ch05-00-structs.html-D74gteI2.js" as="script"><link rel="prefetch" href="/trpl-zh-cn/assets/ch05-01-defining-structs.html-C1ypjOi_.js" as="script"><link rel="prefetch" href="/trpl-zh-cn/assets/ch05-02-example-structs.html-8dNzPsto.js" as="script"><link rel="prefetch" href="/trpl-zh-cn/assets/ch05-03-method-syntax.html-DLIBkqCN.js" as="script"><link rel="prefetch" href="/trpl-zh-cn/assets/ch06-00-enums.html-DnYBvI6n.js" as="script"><link rel="prefetch" href="/trpl-zh-cn/assets/ch06-01-defining-an-enum.html-Bgx31TKA.js" as="script"><link rel="prefetch" href="/trpl-zh-cn/assets/ch06-02-match.html-uxsZntVb.js" as="script"><link rel="prefetch" href="/trpl-zh-cn/assets/ch06-03-if-let.html-B3SNr4R0.js" as="script"><link rel="prefetch" href="/trpl-zh-cn/assets/ch07-00-managing-growing-projects-with-packages-crates-and-modules.html-C1iPPW6I.js" as="script"><link rel="prefetch" href="/trpl-zh-cn/assets/ch07-01-packages-and-crates.html-DEck8Do9.js" as="script"><link rel="prefetch" href="/trpl-zh-cn/assets/ch07-02-defining-modules-to-control-scope-and-privacy.html-DVF_CAsF.js" as="script"><link rel="prefetch" href="/trpl-zh-cn/assets/ch07-03-paths-for-referring-to-an-item-in-the-module-tree.html-DQnVc08I.js" as="script"><link rel="prefetch" href="/trpl-zh-cn/assets/ch07-04-bringing-paths-into-scope-with-the-use-keyword.html-BdLjKfd6.js" as="script"><link rel="prefetch" href="/trpl-zh-cn/assets/ch07-05-separating-modules-into-different-files.html-BFiv8zUR.js" as="script"><link rel="prefetch" href="/trpl-zh-cn/assets/ch08-00-common-collections.html-DxQ2nmw3.js" as="script"><link rel="prefetch" href="/trpl-zh-cn/assets/ch08-01-vectors.html-CLCXyVq7.js" as="script"><link rel="prefetch" href="/trpl-zh-cn/assets/ch08-02-strings.html-Dl3jeY5A.js" as="script"><link rel="prefetch" href="/trpl-zh-cn/assets/ch08-03-hash-maps.html-D98zDKgb.js" as="script"><link rel="prefetch" href="/trpl-zh-cn/assets/ch09-00-error-handling.html-oUplJMlZ.js" as="script"><link rel="prefetch" href="/trpl-zh-cn/assets/ch09-01-unrecoverable-errors-with-panic.html-avAMg8zC.js" as="script"><link rel="prefetch" href="/trpl-zh-cn/assets/ch09-02-recoverable-errors-with-result.html-Ch3hCRLj.js" as="script"><link rel="prefetch" href="/trpl-zh-cn/assets/ch09-03-to-panic-or-not-to-panic.html-DIDW1mjI.js" as="script"><link rel="prefetch" href="/trpl-zh-cn/assets/ch10-00-generics.html-CPmRo44P.js" as="script"><link rel="prefetch" href="/trpl-zh-cn/assets/ch10-01-syntax.html-Cl_Y6WRb.js" as="script"><link rel="prefetch" href="/trpl-zh-cn/assets/ch10-02-traits.html-tiEvzahT.js" as="script"><link rel="prefetch" href="/trpl-zh-cn/assets/ch10-03-lifetime-syntax.html-D43MbtUu.js" as="script"><link rel="prefetch" href="/trpl-zh-cn/assets/ch11-00-testing.html-BykusZgA.js" as="script"><link rel="prefetch" href="/trpl-zh-cn/assets/ch11-01-writing-tests.html-BLCZY6r5.js" as="script"><link rel="prefetch" href="/trpl-zh-cn/assets/ch11-02-running-tests.html-CcSuwmOU.js" as="script"><link rel="prefetch" href="/trpl-zh-cn/assets/ch11-03-test-organization.html-BsjjijZC.js" as="script"><link rel="prefetch" href="/trpl-zh-cn/assets/ch12-00-an-io-project.html-j8wB2qYB.js" as="script"><link rel="prefetch" href="/trpl-zh-cn/assets/ch12-01-accepting-command-line-arguments.html-C1M1ANa8.js" as="script"><link rel="prefetch" href="/trpl-zh-cn/assets/ch12-02-reading-a-file.html-pe1UdgIq.js" as="script"><link rel="prefetch" href="/trpl-zh-cn/assets/ch12-03-improving-error-handling-and-modularity.html-CTtQzw7S.js" as="script"><link rel="prefetch" href="/trpl-zh-cn/assets/ch12-04-testing-the-librarys-functionality.html-pJL95yfL.js" as="script"><link rel="prefetch" href="/trpl-zh-cn/assets/ch12-05-working-with-environment-variables.html-Br12HQV5.js" as="script"><link rel="prefetch" href="/trpl-zh-cn/assets/ch12-06-writing-to-stderr-instead-of-stdout.html-BPBcj1eo.js" as="script"><link rel="prefetch" href="/trpl-zh-cn/assets/ch13-00-functional-features.html-BcvQY32M.js" as="script"><link rel="prefetch" href="/trpl-zh-cn/assets/ch13-01-closures.html-DNecmmxG.js" as="script"><link rel="prefetch" href="/trpl-zh-cn/assets/ch13-02-iterators.html-DvpqR5Uw.js" as="script"><link rel="prefetch" href="/trpl-zh-cn/assets/ch13-03-improving-our-io-project.html-BrjQ2nW_.js" as="script"><link rel="prefetch" href="/trpl-zh-cn/assets/ch13-04-performance.html-CRBQsi5q.js" as="script"><link rel="prefetch" href="/trpl-zh-cn/assets/ch14-00-more-about-cargo.html-DR04wyMO.js" as="script"><link rel="prefetch" href="/trpl-zh-cn/assets/ch14-01-release-profiles.html-WcaJY-_J.js" as="script"><link rel="prefetch" href="/trpl-zh-cn/assets/ch14-02-publishing-to-crates-io.html-zhujer99.js" as="script"><link rel="prefetch" href="/trpl-zh-cn/assets/ch14-03-cargo-workspaces.html-BtQPQasb.js" as="script"><link rel="prefetch" href="/trpl-zh-cn/assets/ch14-04-installing-binaries.html-DAjXkxAX.js" as="script"><link rel="prefetch" href="/trpl-zh-cn/assets/ch14-05-extending-cargo.html-DsxzyW6g.js" as="script"><link rel="prefetch" href="/trpl-zh-cn/assets/ch15-00-smart-pointers.html-1wMdQK7q.js" as="script"><link rel="prefetch" href="/trpl-zh-cn/assets/ch15-01-box.html-BuzVBNFz.js" as="script"><link rel="prefetch" href="/trpl-zh-cn/assets/ch15-02-deref.html-CrBmJWo5.js" as="script"><link rel="prefetch" href="/trpl-zh-cn/assets/ch15-03-drop.html-B1nxA7sP.js" as="script"><link rel="prefetch" href="/trpl-zh-cn/assets/ch15-04-rc.html-CdRbPaob.js" as="script"><link rel="prefetch" href="/trpl-zh-cn/assets/ch15-05-interior-mutability.html-CjO2H9_A.js" as="script"><link rel="prefetch" href="/trpl-zh-cn/assets/ch15-06-reference-cycles.html-C2p0g_nb.js" as="script"><link rel="prefetch" href="/trpl-zh-cn/assets/ch16-00-concurrency.html-Be4U1Ya_.js" as="script"><link rel="prefetch" href="/trpl-zh-cn/assets/ch16-01-threads.html-_DozQWqq.js" as="script"><link rel="prefetch" href="/trpl-zh-cn/assets/ch16-02-message-passing.html-BNJYJup3.js" as="script"><link rel="prefetch" href="/trpl-zh-cn/assets/ch16-03-shared-state.html-CxZdZgSi.js" as="script"><link rel="prefetch" href="/trpl-zh-cn/assets/ch16-04-extensible-concurrency-sync-and-send.html-BygS5ShJ.js" as="script"><link rel="prefetch" href="/trpl-zh-cn/assets/ch17-00-async-await.html-7yD5eG3e.js" as="script"><link rel="prefetch" href="/trpl-zh-cn/assets/ch17-01-futures-and-syntax.html-D95Cfnh6.js" as="script"><link rel="prefetch" href="/trpl-zh-cn/assets/ch17-02-concurrency-with-async.html-BsI2l77T.js" as="script"><link rel="prefetch" href="/trpl-zh-cn/assets/ch17-03-more-futures.html-1Gp7tg8q.js" as="script"><link rel="prefetch" href="/trpl-zh-cn/assets/ch17-04-streams.html-BQP9myKh.js" as="script"><link rel="prefetch" href="/trpl-zh-cn/assets/ch17-06-futures-tasks-threads.html-B23bci3X.js" as="script"><link rel="prefetch" href="/trpl-zh-cn/assets/ch18-00-oop.html-DnDLk3kB.js" as="script"><link rel="prefetch" href="/trpl-zh-cn/assets/ch18-01-what-is-oo.html-BuWy4mrY.js" as="script"><link rel="prefetch" href="/trpl-zh-cn/assets/ch18-02-trait-objects.html-ppRxR6qp.js" as="script"><link rel="prefetch" href="/trpl-zh-cn/assets/ch18-03-oo-design-patterns.html-GQoduU1r.js" as="script"><link rel="prefetch" href="/trpl-zh-cn/assets/ch19-00-patterns.html-Qf2Xbm3P.js" as="script"><link rel="prefetch" href="/trpl-zh-cn/assets/ch19-01-all-the-places-for-patterns.html-CnKqUC2u.js" as="script"><link rel="prefetch" href="/trpl-zh-cn/assets/ch19-02-refutability.html-DIGJqhPO.js" as="script"><link rel="prefetch" href="/trpl-zh-cn/assets/ch19-03-pattern-syntax.html-DAb9Dq55.js" as="script"><link rel="prefetch" href="/trpl-zh-cn/assets/ch20-00-advanced-features.html-DW7b5Us7.js" as="script"><link rel="prefetch" href="/trpl-zh-cn/assets/ch20-01-unsafe-rust.html-BgutkxYM.js" as="script"><link rel="prefetch" href="/trpl-zh-cn/assets/ch20-03-advanced-traits.html-e-VlFBZw.js" as="script"><link rel="prefetch" href="/trpl-zh-cn/assets/ch20-04-advanced-types.html-BvAHwIKF.js" as="script"><link rel="prefetch" href="/trpl-zh-cn/assets/ch20-05-advanced-functions-and-closures.html-BlUdRYOA.js" as="script"><link rel="prefetch" href="/trpl-zh-cn/assets/ch20-06-macros.html-Bi3UNwFn.js" as="script"><link rel="prefetch" href="/trpl-zh-cn/assets/ch21-00-final-project-a-web-server.html-CdfG1ivD.js" as="script"><link rel="prefetch" href="/trpl-zh-cn/assets/ch21-01-single-threaded.html-Agpgcw44.js" as="script"><link rel="prefetch" href="/trpl-zh-cn/assets/ch21-02-multithreaded.html-bmfViIM1.js" as="script"><link rel="prefetch" href="/trpl-zh-cn/assets/ch21-03-graceful-shutdown-and-cleanup.html-C11vVsCG.js" as="script"><link rel="prefetch" href="/trpl-zh-cn/assets/foreword.html-wPfKLf_a.js" as="script"><link rel="prefetch" href="/trpl-zh-cn/assets/title-page.html-CU32Mlg1.js" as="script"><link rel="prefetch" href="/trpl-zh-cn/assets/404.html-B4Zluy_I.js" as="script"><link rel="prefetch" href="/trpl-zh-cn/assets/index.html-DOge2kn5.js" as="script"><link rel="prefetch" href="/trpl-zh-cn/assets/index.html-DXz44SIN.js" as="script"><link rel="prefetch" href="/trpl-zh-cn/assets/index.html-DIftlefh.js" as="script"><link rel="prefetch" href="/trpl-zh-cn/assets/index.html-BRfXtvxv.js" as="script"><link rel="prefetch" href="/trpl-zh-cn/assets/index.html-MpufYYDb.js" as="script"><link rel="prefetch" href="/trpl-zh-cn/assets/index.html-gu61EDmh.js" as="script"><link rel="prefetch" href="/trpl-zh-cn/assets/index-B7Dsp4JB.js" as="script"><link rel="prefetch" href="/trpl-zh-cn/assets/index-BXUAA3OA.js" as="script"><link rel="prefetch" href="/trpl-zh-cn/assets/index-DRWmbcXV.js" as="script"><link rel="prefetch" href="/trpl-zh-cn/assets/mermaid.esm.min-dp8Sjlqq.js" as="script"><link rel="prefetch" href="/trpl-zh-cn/assets/photoswipe.esm-DXWKOczD.js" as="script"><link rel="prefetch" href="/trpl-zh-cn/assets/SearchResult-VrAVw6a8.js" as="script"><link rel="prefetch" href="/trpl-zh-cn/assets/setupDevtools-QXEOFQJV-Cb82N0Ng.js" as="script">
  </head>
  <body>
    <div id="app"><!--[--><!--[--><!----><!--[--><span tabindex="-1"></span><a href="#main-content" class="vp-skip-link sr-only">跳至主要內容</a><!--]--><!--[--><div class="theme-container external-link-icon has-toc" vp-container><!--[--><header id="navbar" class="vp-navbar" vp-navbar><div class="vp-navbar-start"><button type="button" class="vp-toggle-sidebar-button" title="Toggle Sidebar"><span class="icon"></span></button><!--[--><a class="route-link vp-brand" href="/trpl-zh-cn/" aria-label="带我回家"><img class="vp-nav-logo" src="/trpl-zh-cn/logo.svg" alt><!----><span class="vp-site-name hide-in-pad">trpl-zh-cn</span></a><!--]--></div><div class="vp-navbar-center"><!--[--><!--]--></div><div class="vp-navbar-end"><!--[--><nav class="vp-nav-links"><div class="vp-nav-item hide-in-mobile"><a class="route-link auto-link" href="/trpl-zh-cn/" aria-label="/" iconsizing="height"><!---->/<!----></a></div></nav><!----><div class="vp-nav-item vp-action"><a class="vp-action-link" href="https://github.com/LincDocs/trpl-zh-cn" target="_blank" rel="noopener noreferrer" aria-label="GitHub"><svg xmlns="http://www.w3.org/2000/svg" class="icon github-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="github icon" name="github" style="width:1.25rem;height:1.25rem;vertical-align:middle;"><path d="M511.957 21.333C241.024 21.333 21.333 240.981 21.333 512c0 216.832 140.544 400.725 335.574 465.664 24.49 4.395 32.256-10.07 32.256-23.083 0-11.69.256-44.245 0-85.205-136.448 29.61-164.736-64.64-164.736-64.64-22.315-56.704-54.4-71.765-54.4-71.765-44.587-30.464 3.285-29.824 3.285-29.824 49.195 3.413 75.179 50.517 75.179 50.517 43.776 75.008 114.816 53.333 142.762 40.79 4.523-31.66 17.152-53.377 31.19-65.537-108.971-12.458-223.488-54.485-223.488-242.602 0-53.547 19.114-97.323 50.517-131.67-5.035-12.33-21.93-62.293 4.779-129.834 0 0 41.258-13.184 134.912 50.346a469.803 469.803 0 0 1 122.88-16.554c41.642.213 83.626 5.632 122.88 16.554 93.653-63.488 134.784-50.346 134.784-50.346 26.752 67.541 9.898 117.504 4.864 129.834 31.402 34.347 50.474 78.123 50.474 131.67 0 188.586-114.73 230.016-224.042 242.09 17.578 15.232 33.578 44.672 33.578 90.454v135.85c0 13.142 7.936 27.606 32.854 22.87C862.25 912.597 1002.667 728.747 1002.667 512c0-271.019-219.648-490.667-490.71-490.667z"></path></svg></a></div><div class="vp-nav-item hide-in-mobile"><button type="button" class="vp-color-mode-switch" id="color-mode-switch"><svg xmlns="http://www.w3.org/2000/svg" class="icon auto-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="auto icon" name="auto" style="display:block;"><path d="M512 992C246.92 992 32 777.08 32 512S246.92 32 512 32s480 214.92 480 480-214.92 480-480 480zm0-840c-198.78 0-360 161.22-360 360 0 198.84 161.22 360 360 360s360-161.16 360-360c0-198.78-161.22-360-360-360zm0 660V212c165.72 0 300 134.34 300 300 0 165.72-134.28 300-300 300z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon dark-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="dark icon" name="dark" style="display:none;"><path d="M524.8 938.667h-4.267a439.893 439.893 0 0 1-313.173-134.4 446.293 446.293 0 0 1-11.093-597.334A432.213 432.213 0 0 1 366.933 90.027a42.667 42.667 0 0 1 45.227 9.386 42.667 42.667 0 0 1 10.24 42.667 358.4 358.4 0 0 0 82.773 375.893 361.387 361.387 0 0 0 376.747 82.774 42.667 42.667 0 0 1 54.187 55.04 433.493 433.493 0 0 1-99.84 154.88 438.613 438.613 0 0 1-311.467 128z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon light-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="light icon" name="light" style="display:none;"><path d="M952 552h-80a40 40 0 0 1 0-80h80a40 40 0 0 1 0 80zM801.88 280.08a41 41 0 0 1-57.96-57.96l57.96-58a41.04 41.04 0 0 1 58 58l-58 57.96zM512 752a240 240 0 1 1 0-480 240 240 0 0 1 0 480zm0-560a40 40 0 0 1-40-40V72a40 40 0 0 1 80 0v80a40 40 0 0 1-40 40zm-289.88 88.08-58-57.96a41.04 41.04 0 0 1 58-58l57.96 58a41 41 0 0 1-57.96 57.96zM192 512a40 40 0 0 1-40 40H72a40 40 0 0 1 0-80h80a40 40 0 0 1 40 40zm30.12 231.92a41 41 0 0 1 57.96 57.96l-57.96 58a41.04 41.04 0 0 1-58-58l58-57.96zM512 832a40 40 0 0 1 40 40v80a40 40 0 0 1-80 0v-80a40 40 0 0 1 40-40zm289.88-88.08 58 57.96a41.04 41.04 0 0 1-58 58l-57.96-58a41 41 0 0 1 57.96-57.96z"></path></svg></button></div><!--[--><button type="button" class="slimsearch-button" aria-label="搜索"><svg xmlns="http://www.w3.org/2000/svg" class="icon search-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="search icon"><path d="M192 480a256 256 0 1 1 512 0 256 256 0 0 1-512 0m631.776 362.496-143.2-143.168A318.464 318.464 0 0 0 768 480c0-176.736-143.264-320-320-320S128 303.264 128 480s143.264 320 320 320a318.016 318.016 0 0 0 184.16-58.592l146.336 146.368c12.512 12.48 32.768 12.48 45.28 0 12.48-12.512 12.48-32.768 0-45.28"></path></svg><div class="slimsearch-placeholder">搜索</div><div class="slimsearch-key-hints"><kbd class="slimsearch-key">Ctrl</kbd><kbd class="slimsearch-key">K</kbd></div></button><!--]--><!--[--><!-- 如果要调试就将第二个改成true --><div class="read-enhance vp-nav-item" data-v-fce98c20><div class="read-enhance-icon" data-v-fce98c20><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-book-open" data-v-fce98c20><path d="M12 7v14" data-v-fce98c20></path><path d="M3 18a1 1 0 0 1-1-1V4a1 1 0 0 1 1-1h5a4 4 0 0 1 4 4 4 4 0 0 1 4-4h5a1 1 0 0 1 1 1v13a1 1 0 0 1-1 1h-6a3 3 0 0 0-3 3 3 3 0 0 0-3-3z" data-v-fce98c20></path></svg></div><!----></div><!--]--><!--]--><button type="button" class="vp-toggle-navbar-button" aria-label="Toggle Navbar" aria-expanded="false" aria-controls="nav-screen"><span><span class="vp-top"></span><span class="vp-middle"></span><span class="vp-bottom"></span></span></button></div></header><!----><!--]--><!----><div class="toggle-sidebar-wrapper"><span class="arrow start"></span></div><aside id="sidebar" class="vp-sidebar" vp-sidebar><!--[--><div class="root-sidebar" data-v-8a39d0c0><div class="root-sidebar-control" data-v-8a39d0c0><div class="root-sidebar-btn" data-v-8a39d0c0><!-- <button title="升序/降序排序">Ord</button> --><button class="" title="切换显示: 文件名-&gt;H1" data-v-8a39d0c0><svg xmlns="http://www.w3.org/2000/svg" width="16" height="20" viewBox="1 -4 22 22" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-heading" data-v-8a39d0c0><path d="M6 12h12" data-v-8a39d0c0></path><path d="M6 20V4" data-v-8a39d0c0></path><path d="M18 20V4" data-v-8a39d0c0></path></svg></button><button class="" title="切换新旧侧边栏" data-v-8a39d0c0><svg xmlns="http://www.w3.org/2000/svg" width="20" height="26" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-arrow-down-up" data-v-8a39d0c0><path d="m3 16 4 4 4-4" data-v-8a39d0c0></path><path d="M7 20V4" data-v-8a39d0c0></path><path d="m21 8-4-4-4 4" data-v-8a39d0c0></path><path d="M17 4v16" data-v-8a39d0c0></path></svg></button><button class="active" title="使用SUMMARY源" data-v-8a39d0c0><svg xmlns="http://www.w3.org/2000/svg" width="20" height="26" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-arrow-down-up" data-v-8a39d0c0><path d="m3 16 4 4 4-4" data-v-8a39d0c0></path><path d="M7 20V4" data-v-8a39d0c0></path><path d="m21 8-4-4-4 4" data-v-8a39d0c0></path><path d="M17 4v16" data-v-8a39d0c0></path></svg></button><button title="固定或删除当前标签页" data-v-8a39d0c0><svg xmlns="http://www.w3.org/2000/svg" width="20" height="26" viewBox="0 -1 24 24" fill="none" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-pin" data-v-8a39d0c0><path d="M12 17v5" data-v-8a39d0c0></path><path d="M9 10.76a2 2 0 0 1-1.11 1.79l-1.78.9A2 2 0 0 0 5 15.24V16a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1v-.76a2 2 0 0 0-1.11-1.79l-1.78-.9A2 2 0 0 1 15 10.76V7a1 1 0 0 1 1-1 2 2 0 0 0 0-4H8a2 2 0 0 0 0 4 1 1 0 0 1 1 1z" data-v-8a39d0c0></path></svg></button><button title="显示更多侧边项" data-v-8a39d0c0><svg xmlns="http://www.w3.org/2000/svg" width="10" height="26" viewBox="6 5 12 12" fill="none" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-chevron-left" data-v-8a39d0c0><path d="m15 18-6-6 6-6" data-v-8a39d0c0></path></svg></button><button title="精简更少侧边项" data-v-8a39d0c0><svg xmlns="http://www.w3.org/2000/svg" width="10" height="26" viewBox="5 5 12 12" fill="none" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-chevron-right" data-v-8a39d0c0><path d="m9 18 6-6-6-6" data-v-8a39d0c0></path></svg></button></div><div class="root-sidebar-breadcrumb" data-v-8a39d0c0><!-- TODO: 下拉框，路径下拉表示、排序、固定伪标签页 --><!--[--><button relDeep="0" data-v-8a39d0c0><span title="/" data-v-8a39d0c0>/</span></button><!--]--></div></div><div class="root-sidebar-content2" data-v-8a39d0c0><!-- 固定标签, 伪标签栏  --><ul class="sidebar-item-children" data-v-8a39d0c0 data-v-4691a116><!--[--><!--]--></ul><div style="display:none;" data-v-8a39d0c0><hr data-v-8a39d0c0></div></div><div class="root-sidebar-content" data-v-8a39d0c0><ul class="sidebar-item-children" data-v-8a39d0c0 data-v-4691a116><!--[--><li data-v-4691a116><!-- 文件-1 --><!--[--><!-- 文件夹 --><div class="sidebar-item folder" unfold="true" data-v-4691a116><div class="sidebar-item-name folder" relDeep="1" style="padding-inline-start:24px" data-v-4691a116><a title="/Rust 程序设计语言/" data-v-4691a116>Rust 程序设计语言</a></div><ul class="sidebar-item-children" data-v-4691a116 data-v-4691a116><!--[--><li data-v-4691a116><!-- 文件-1 --><!--[--><!--  文件-2 --><div class="sidebar-item file" data-v-4691a116><div class="sidebar-item-name file" relDeep="2" style="padding-inline-start:44px" data-v-4691a116><a href="/trpl-zh-cn/title-page.html" class="" title="/title-page.html" data-v-4691a116>Rust 程序设计语言</a></div></div><!--]--></li><li data-v-4691a116><!-- 文件-1 --><!--[--><!--  文件-2 --><div class="sidebar-item file" data-v-4691a116><div class="sidebar-item-name file" relDeep="2" style="padding-inline-start:44px" data-v-4691a116><a href="/trpl-zh-cn/foreword.html" class="" title="/foreword.html" data-v-4691a116>前言</a></div></div><!--]--></li><li data-v-4691a116><!-- 文件-1 --><!--[--><!--  文件-2 --><div class="sidebar-item file" data-v-4691a116><div class="sidebar-item-name file" relDeep="2" style="padding-inline-start:44px" data-v-4691a116><a href="/trpl-zh-cn/ch00-00-introduction.html" class="" title="/ch00-00-introduction.html" data-v-4691a116>简介</a></div></div><!--]--></li><li data-v-4691a116><!-- 文件-1 --><!--[--><!-- 文件夹 --><div class="sidebar-item folder" unfold="true" data-v-4691a116><div class="sidebar-item-name folder" relDeep="2" style="padding-inline-start:44px" data-v-4691a116><a title="/Rust 程序设计语言/入门指南/" data-v-4691a116>入门指南</a></div><ul class="sidebar-item-children" data-v-4691a116 data-v-4691a116><!--[--><li data-v-4691a116><!-- 文件-1 --><!--[--><!-- 文件夹 --><div class="sidebar-item folder" unfold="false" data-v-4691a116><div class="sidebar-item-name folder" relDeep="3" style="padding-inline-start:64px" data-v-4691a116><a title="/Rust 程序设计语言/入门指南/入门指南/" data-v-4691a116>入门指南</a></div><!----></div><!--]--></li><li data-v-4691a116><!-- 文件-1 --><!--[--><!--  文件-2 --><div class="sidebar-item file" data-v-4691a116><div class="sidebar-item-name file" relDeep="3" style="padding-inline-start:64px" data-v-4691a116><a href="/trpl-zh-cn/ch02-00-guessing-game-tutorial.html" class="" title="/ch02-00-guessing-game-tutorial.html" data-v-4691a116>写个猜数字游戏</a></div></div><!--]--></li><li data-v-4691a116><!-- 文件-1 --><!--[--><!-- 文件夹 --><div class="sidebar-item folder" unfold="false" data-v-4691a116><div class="sidebar-item-name folder" relDeep="3" style="padding-inline-start:64px" data-v-4691a116><a title="/Rust 程序设计语言/入门指南/常见编程概念/" data-v-4691a116>常见编程概念</a></div><!----></div><!--]--></li><li data-v-4691a116><!-- 文件-1 --><!--[--><!-- 文件夹 --><div class="sidebar-item folder" unfold="false" data-v-4691a116><div class="sidebar-item-name folder" relDeep="3" style="padding-inline-start:64px" data-v-4691a116><a title="/Rust 程序设计语言/入门指南/认识所有权/" data-v-4691a116>认识所有权</a></div><!----></div><!--]--></li><li data-v-4691a116><!-- 文件-1 --><!--[--><!-- 文件夹 --><div class="sidebar-item folder" unfold="false" data-v-4691a116><div class="sidebar-item-name folder" relDeep="3" style="padding-inline-start:64px" data-v-4691a116><a title="/Rust 程序设计语言/入门指南/使用结构体组织相关联的数据/" data-v-4691a116>使用结构体组织相关联的数据</a></div><!----></div><!--]--></li><li data-v-4691a116><!-- 文件-1 --><!--[--><!-- 文件夹 --><div class="sidebar-item folder" unfold="false" data-v-4691a116><div class="sidebar-item-name folder" relDeep="3" style="padding-inline-start:64px" data-v-4691a116><a title="/Rust 程序设计语言/入门指南/枚举和模式匹配/" data-v-4691a116>枚举和模式匹配</a></div><!----></div><!--]--></li><!--]--></ul></div><!--]--></li><li data-v-4691a116><!-- 文件-1 --><!--[--><!-- 文件夹 --><div class="sidebar-item folder" unfold="true" data-v-4691a116><div class="sidebar-item-name folder" relDeep="2" style="padding-inline-start:44px" data-v-4691a116><a title="/Rust 程序设计语言/基本 Rust 技能/" data-v-4691a116>基本 Rust 技能</a></div><ul class="sidebar-item-children" data-v-4691a116 data-v-4691a116><!--[--><li data-v-4691a116><!-- 文件-1 --><!--[--><!-- 文件夹 --><div class="sidebar-item folder" unfold="false" data-v-4691a116><div class="sidebar-item-name folder" relDeep="3" style="padding-inline-start:64px" data-v-4691a116><a title="/Rust 程序设计语言/基本 Rust 技能/使用包、Crate 和模块管理不断增长的项目/" data-v-4691a116>使用包、Crate 和模块管理不断增长的项目</a></div><!----></div><!--]--></li><li data-v-4691a116><!-- 文件-1 --><!--[--><!-- 文件夹 --><div class="sidebar-item folder" unfold="false" data-v-4691a116><div class="sidebar-item-name folder" relDeep="3" style="padding-inline-start:64px" data-v-4691a116><a title="/Rust 程序设计语言/基本 Rust 技能/常见集合/" data-v-4691a116>常见集合</a></div><!----></div><!--]--></li><li data-v-4691a116><!-- 文件-1 --><!--[--><!-- 文件夹 --><div class="sidebar-item folder" unfold="false" data-v-4691a116><div class="sidebar-item-name folder" relDeep="3" style="padding-inline-start:64px" data-v-4691a116><a title="/Rust 程序设计语言/基本 Rust 技能/错误处理/" data-v-4691a116>错误处理</a></div><!----></div><!--]--></li><li data-v-4691a116><!-- 文件-1 --><!--[--><!-- 文件夹 --><div class="sidebar-item folder" unfold="false" data-v-4691a116><div class="sidebar-item-name folder" relDeep="3" style="padding-inline-start:64px" data-v-4691a116><a title="/Rust 程序设计语言/基本 Rust 技能/泛型、Trait 和生命周期/" data-v-4691a116>泛型、Trait 和生命周期</a></div><!----></div><!--]--></li><li data-v-4691a116><!-- 文件-1 --><!--[--><!-- 文件夹 --><div class="sidebar-item folder" unfold="false" data-v-4691a116><div class="sidebar-item-name folder" relDeep="3" style="padding-inline-start:64px" data-v-4691a116><a title="/Rust 程序设计语言/基本 Rust 技能/编写自动化测试/" data-v-4691a116>编写自动化测试</a></div><!----></div><!--]--></li><li data-v-4691a116><!-- 文件-1 --><!--[--><!-- 文件夹 --><div class="sidebar-item folder" unfold="false" data-v-4691a116><div class="sidebar-item-name folder" relDeep="3" style="padding-inline-start:64px" data-v-4691a116><a title="/Rust 程序设计语言/基本 Rust 技能/一个 I/O 项目：构建命令行程序/" data-v-4691a116>一个 I/O 项目：构建命令行程序</a></div><!----></div><!--]--></li><!--]--></ul></div><!--]--></li><li data-v-4691a116><!-- 文件-1 --><!--[--><!-- 文件夹 --><div class="sidebar-item folder" unfold="true" data-v-4691a116><div class="sidebar-item-name folder" relDeep="2" style="padding-inline-start:44px" data-v-4691a116><a title="/Rust 程序设计语言/Rust 编程思想/" data-v-4691a116>Rust 编程思想</a></div><ul class="sidebar-item-children" data-v-4691a116 data-v-4691a116><!--[--><li data-v-4691a116><!-- 文件-1 --><!--[--><!-- 文件夹 --><div class="sidebar-item folder" unfold="false" data-v-4691a116><div class="sidebar-item-name folder" relDeep="3" style="padding-inline-start:64px" data-v-4691a116><a title="/Rust 程序设计语言/Rust 编程思想/Rust 中的函数式语言功能：迭代器与闭包/" data-v-4691a116>Rust 中的函数式语言功能：迭代器与闭包</a></div><!----></div><!--]--></li><li data-v-4691a116><!-- 文件-1 --><!--[--><!-- 文件夹 --><div class="sidebar-item folder" unfold="false" data-v-4691a116><div class="sidebar-item-name folder" relDeep="3" style="padding-inline-start:64px" data-v-4691a116><a title="/Rust 程序设计语言/Rust 编程思想/更多关于 Cargo 和 Crates.io 的内容/" data-v-4691a116>更多关于 Cargo 和 Crates.io 的内容</a></div><!----></div><!--]--></li><li data-v-4691a116><!-- 文件-1 --><!--[--><!-- 文件夹 --><div class="sidebar-item folder" unfold="false" data-v-4691a116><div class="sidebar-item-name folder" relDeep="3" style="padding-inline-start:64px" data-v-4691a116><a title="/Rust 程序设计语言/Rust 编程思想/智能指针/" data-v-4691a116>智能指针</a></div><!----></div><!--]--></li><li data-v-4691a116><!-- 文件-1 --><!--[--><!-- 文件夹 --><div class="sidebar-item folder" unfold="false" data-v-4691a116><div class="sidebar-item-name folder" relDeep="3" style="padding-inline-start:64px" data-v-4691a116><a title="/Rust 程序设计语言/Rust 编程思想/无畏并发/" data-v-4691a116>无畏并发</a></div><!----></div><!--]--></li><li data-v-4691a116><!-- 文件-1 --><!--[--><!-- 文件夹 --><div class="sidebar-item folder" unfold="false" data-v-4691a116><div class="sidebar-item-name folder" relDeep="3" style="padding-inline-start:64px" data-v-4691a116><a title="/Rust 程序设计语言/Rust 编程思想/Async 和 await/" data-v-4691a116>Async 和 await</a></div><!----></div><!--]--></li><li data-v-4691a116><!-- 文件-1 --><!--[--><!-- 文件夹 --><div class="sidebar-item folder" unfold="false" data-v-4691a116><div class="sidebar-item-name folder" relDeep="3" style="padding-inline-start:64px" data-v-4691a116><a title="/Rust 程序设计语言/Rust 编程思想/Rust 的面向对象编程特性/" data-v-4691a116>Rust 的面向对象编程特性</a></div><!----></div><!--]--></li><!--]--></ul></div><!--]--></li><li data-v-4691a116><!-- 文件-1 --><!--[--><!-- 文件夹 --><div class="sidebar-item folder" unfold="true" data-v-4691a116><div class="sidebar-item-name folder" relDeep="2" style="padding-inline-start:44px" data-v-4691a116><a title="/Rust 程序设计语言/高级主题/" data-v-4691a116>高级主题</a></div><ul class="sidebar-item-children" data-v-4691a116 data-v-4691a116><!--[--><li data-v-4691a116><!-- 文件-1 --><!--[--><!-- 文件夹 --><div class="sidebar-item folder" unfold="false" data-v-4691a116><div class="sidebar-item-name folder" relDeep="3" style="padding-inline-start:64px" data-v-4691a116><a title="/Rust 程序设计语言/高级主题/模式与模式匹配/" data-v-4691a116>模式与模式匹配</a></div><!----></div><!--]--></li><li data-v-4691a116><!-- 文件-1 --><!--[--><!-- 文件夹 --><div class="sidebar-item folder" unfold="false" data-v-4691a116><div class="sidebar-item-name folder" relDeep="3" style="padding-inline-start:64px" data-v-4691a116><a title="/Rust 程序设计语言/高级主题/高级特性/" data-v-4691a116>高级特性</a></div><!----></div><!--]--></li><li data-v-4691a116><!-- 文件-1 --><!--[--><!-- 文件夹 --><div class="sidebar-item folder" unfold="false" data-v-4691a116><div class="sidebar-item-name folder" relDeep="3" style="padding-inline-start:64px" data-v-4691a116><a title="/Rust 程序设计语言/高级主题/最后的项目：构建多线程 web server/" data-v-4691a116>最后的项目：构建多线程 web server</a></div><!----></div><!--]--></li><li data-v-4691a116><!-- 文件-1 --><!--[--><!-- 文件夹 --><div class="sidebar-item folder" unfold="false" data-v-4691a116><div class="sidebar-item-name folder" relDeep="3" style="padding-inline-start:64px" data-v-4691a116><a title="/Rust 程序设计语言/高级主题/附录/" data-v-4691a116>附录</a></div><!----></div><!--]--></li><!--]--></ul></div><!--]--></li><!--]--></ul></div><!--]--></li><!--]--></ul></div></div><!--]--><ul class="vp-sidebar-links"><li><a class="route-link auto-link vp-sidebar-link" href="/trpl-zh-cn/" aria-label="Rust 程序设计语言" iconsizing="both"><!---->Rust 程序设计语言<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/trpl-zh-cn/appendix-00.html" aria-label="附录" iconsizing="both"><!---->附录<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/trpl-zh-cn/appendix-01-keywords.html" aria-label="/appendix-01-keywords.html" iconsizing="both"><!---->/appendix-01-keywords.html<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/trpl-zh-cn/appendix-02-operators.html" aria-label="/appendix-02-operators.html" iconsizing="both"><!---->/appendix-02-operators.html<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/trpl-zh-cn/appendix-03-derivable-traits.html" aria-label="/appendix-03-derivable-traits.html" iconsizing="both"><!---->/appendix-03-derivable-traits.html<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/trpl-zh-cn/appendix-04-useful-development-tools.html" aria-label="/appendix-04-useful-development-tools.html" iconsizing="both"><!---->/appendix-04-useful-development-tools.html<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/trpl-zh-cn/appendix-05-editions.html" aria-label="/appendix-05-editions.html" iconsizing="both"><!---->/appendix-05-editions.html<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/trpl-zh-cn/appendix-06-translation.html" aria-label="/appendix-06-translation.html" iconsizing="both"><!---->/appendix-06-translation.html<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/trpl-zh-cn/appendix-07-nightly-rust.html" aria-label="/appendix-07-nightly-rust.html" iconsizing="both"><!---->/appendix-07-nightly-rust.html<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/trpl-zh-cn/ch00-00-introduction.html" aria-label="简介" iconsizing="both"><!---->简介<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/trpl-zh-cn/ch01-00-getting-started.html" aria-label="入门指南" iconsizing="both"><!---->入门指南<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/trpl-zh-cn/ch01-01-installation.html" aria-label="/ch01-01-installation.html" iconsizing="both"><!---->/ch01-01-installation.html<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/trpl-zh-cn/ch01-02-hello-world.html" aria-label="/ch01-02-hello-world.html" iconsizing="both"><!---->/ch01-02-hello-world.html<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/trpl-zh-cn/ch01-03-hello-cargo.html" aria-label="/ch01-03-hello-cargo.html" iconsizing="both"><!---->/ch01-03-hello-cargo.html<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/trpl-zh-cn/ch02-00-guessing-game-tutorial.html" aria-label="写个猜数字游戏" iconsizing="both"><!---->写个猜数字游戏<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/trpl-zh-cn/ch03-00-common-programming-concepts.html" aria-label="常见编程概念" iconsizing="both"><!---->常见编程概念<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/trpl-zh-cn/ch03-01-variables-and-mutability.html" aria-label="/ch03-01-variables-and-mutability.html" iconsizing="both"><!---->/ch03-01-variables-and-mutability.html<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/trpl-zh-cn/ch03-02-data-types.html" aria-label="/ch03-02-data-types.html" iconsizing="both"><!---->/ch03-02-data-types.html<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/trpl-zh-cn/ch03-03-how-functions-work.html" aria-label="/ch03-03-how-functions-work.html" iconsizing="both"><!---->/ch03-03-how-functions-work.html<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/trpl-zh-cn/ch03-04-comments.html" aria-label="/ch03-04-comments.html" iconsizing="both"><!---->/ch03-04-comments.html<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/trpl-zh-cn/ch03-05-control-flow.html" aria-label="/ch03-05-control-flow.html" iconsizing="both"><!---->/ch03-05-control-flow.html<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/trpl-zh-cn/ch04-00-understanding-ownership.html" aria-label="认识所有权" iconsizing="both"><!---->认识所有权<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/trpl-zh-cn/ch04-01-what-is-ownership.html" aria-label="/ch04-01-what-is-ownership.html" iconsizing="both"><!---->/ch04-01-what-is-ownership.html<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/trpl-zh-cn/ch04-02-references-and-borrowing.html" aria-label="/ch04-02-references-and-borrowing.html" iconsizing="both"><!---->/ch04-02-references-and-borrowing.html<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/trpl-zh-cn/ch04-03-slices.html" aria-label="/ch04-03-slices.html" iconsizing="both"><!---->/ch04-03-slices.html<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/trpl-zh-cn/ch05-00-structs.html" aria-label="使用结构体组织相关联的数据" iconsizing="both"><!---->使用结构体组织相关联的数据<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/trpl-zh-cn/ch05-01-defining-structs.html" aria-label="/ch05-01-defining-structs.html" iconsizing="both"><!---->/ch05-01-defining-structs.html<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/trpl-zh-cn/ch05-02-example-structs.html" aria-label="/ch05-02-example-structs.html" iconsizing="both"><!---->/ch05-02-example-structs.html<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/trpl-zh-cn/ch05-03-method-syntax.html" aria-label="/ch05-03-method-syntax.html" iconsizing="both"><!---->/ch05-03-method-syntax.html<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/trpl-zh-cn/ch06-00-enums.html" aria-label="枚举和模式匹配" iconsizing="both"><!---->枚举和模式匹配<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/trpl-zh-cn/ch06-01-defining-an-enum.html" aria-label="/ch06-01-defining-an-enum.html" iconsizing="both"><!---->/ch06-01-defining-an-enum.html<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/trpl-zh-cn/ch06-02-match.html" aria-label="/ch06-02-match.html" iconsizing="both"><!---->/ch06-02-match.html<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/trpl-zh-cn/ch06-03-if-let.html" aria-label="/ch06-03-if-let.html" iconsizing="both"><!---->/ch06-03-if-let.html<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/trpl-zh-cn/ch07-00-managing-growing-projects-with-packages-crates-and-modules.html" aria-label="使用包、Crate 和模块管理不断增长的项目" iconsizing="both"><!---->使用包、Crate 和模块管理不断增长的项目<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/trpl-zh-cn/ch07-01-packages-and-crates.html" aria-label="/ch07-01-packages-and-crates.html" iconsizing="both"><!---->/ch07-01-packages-and-crates.html<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/trpl-zh-cn/ch07-02-defining-modules-to-control-scope-and-privacy.html" aria-label="/ch07-02-defining-modules-to-control-scope-and-privacy.html" iconsizing="both"><!---->/ch07-02-defining-modules-to-control-scope-and-privacy.html<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/trpl-zh-cn/ch07-03-paths-for-referring-to-an-item-in-the-module-tree.html" aria-label="/ch07-03-paths-for-referring-to-an-item-in-the-module-tree.html" iconsizing="both"><!---->/ch07-03-paths-for-referring-to-an-item-in-the-module-tree.html<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/trpl-zh-cn/ch07-04-bringing-paths-into-scope-with-the-use-keyword.html" aria-label="/ch07-04-bringing-paths-into-scope-with-the-use-keyword.html" iconsizing="both"><!---->/ch07-04-bringing-paths-into-scope-with-the-use-keyword.html<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/trpl-zh-cn/ch07-05-separating-modules-into-different-files.html" aria-label="/ch07-05-separating-modules-into-different-files.html" iconsizing="both"><!---->/ch07-05-separating-modules-into-different-files.html<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/trpl-zh-cn/ch08-00-common-collections.html" aria-label="常见集合" iconsizing="both"><!---->常见集合<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/trpl-zh-cn/ch08-01-vectors.html" aria-label="/ch08-01-vectors.html" iconsizing="both"><!---->/ch08-01-vectors.html<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/trpl-zh-cn/ch08-02-strings.html" aria-label="/ch08-02-strings.html" iconsizing="both"><!---->/ch08-02-strings.html<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/trpl-zh-cn/ch08-03-hash-maps.html" aria-label="/ch08-03-hash-maps.html" iconsizing="both"><!---->/ch08-03-hash-maps.html<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/trpl-zh-cn/ch09-00-error-handling.html" aria-label="错误处理" iconsizing="both"><!---->错误处理<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/trpl-zh-cn/ch09-01-unrecoverable-errors-with-panic.html" aria-label="/ch09-01-unrecoverable-errors-with-panic.html" iconsizing="both"><!---->/ch09-01-unrecoverable-errors-with-panic.html<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/trpl-zh-cn/ch09-02-recoverable-errors-with-result.html" aria-label="/ch09-02-recoverable-errors-with-result.html" iconsizing="both"><!---->/ch09-02-recoverable-errors-with-result.html<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/trpl-zh-cn/ch09-03-to-panic-or-not-to-panic.html" aria-label="/ch09-03-to-panic-or-not-to-panic.html" iconsizing="both"><!---->/ch09-03-to-panic-or-not-to-panic.html<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/trpl-zh-cn/ch10-00-generics.html" aria-label="泛型、Trait 和生命周期" iconsizing="both"><!---->泛型、Trait 和生命周期<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/trpl-zh-cn/ch10-01-syntax.html" aria-label="/ch10-01-syntax.html" iconsizing="both"><!---->/ch10-01-syntax.html<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/trpl-zh-cn/ch10-02-traits.html" aria-label="/ch10-02-traits.html" iconsizing="both"><!---->/ch10-02-traits.html<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/trpl-zh-cn/ch10-03-lifetime-syntax.html" aria-label="/ch10-03-lifetime-syntax.html" iconsizing="both"><!---->/ch10-03-lifetime-syntax.html<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/trpl-zh-cn/ch11-00-testing.html" aria-label="编写自动化测试" iconsizing="both"><!---->编写自动化测试<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/trpl-zh-cn/ch11-01-writing-tests.html" aria-label="/ch11-01-writing-tests.html" iconsizing="both"><!---->/ch11-01-writing-tests.html<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/trpl-zh-cn/ch11-02-running-tests.html" aria-label="/ch11-02-running-tests.html" iconsizing="both"><!---->/ch11-02-running-tests.html<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/trpl-zh-cn/ch11-03-test-organization.html" aria-label="/ch11-03-test-organization.html" iconsizing="both"><!---->/ch11-03-test-organization.html<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/trpl-zh-cn/ch12-00-an-io-project.html" aria-label="一个 I/O 项目：构建一个命令行程序" iconsizing="both"><!---->一个 I/O 项目：构建一个命令行程序<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/trpl-zh-cn/ch12-01-accepting-command-line-arguments.html" aria-label="/ch12-01-accepting-command-line-arguments.html" iconsizing="both"><!---->/ch12-01-accepting-command-line-arguments.html<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/trpl-zh-cn/ch12-02-reading-a-file.html" aria-label="/ch12-02-reading-a-file.html" iconsizing="both"><!---->/ch12-02-reading-a-file.html<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/trpl-zh-cn/ch12-03-improving-error-handling-and-modularity.html" aria-label="/ch12-03-improving-error-handling-and-modularity.html" iconsizing="both"><!---->/ch12-03-improving-error-handling-and-modularity.html<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/trpl-zh-cn/ch12-04-testing-the-librarys-functionality.html" aria-label="/ch12-04-testing-the-librarys-functionality.html" iconsizing="both"><!---->/ch12-04-testing-the-librarys-functionality.html<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/trpl-zh-cn/ch12-05-working-with-environment-variables.html" aria-label="/ch12-05-working-with-environment-variables.html" iconsizing="both"><!---->/ch12-05-working-with-environment-variables.html<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/trpl-zh-cn/ch12-06-writing-to-stderr-instead-of-stdout.html" aria-label="/ch12-06-writing-to-stderr-instead-of-stdout.html" iconsizing="both"><!---->/ch12-06-writing-to-stderr-instead-of-stdout.html<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/trpl-zh-cn/ch13-00-functional-features.html" aria-label="Rust 中的函数式语言功能：迭代器与闭包" iconsizing="both"><!---->Rust 中的函数式语言功能：迭代器与闭包<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/trpl-zh-cn/ch13-01-closures.html" aria-label="/ch13-01-closures.html" iconsizing="both"><!---->/ch13-01-closures.html<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/trpl-zh-cn/ch13-02-iterators.html" aria-label="/ch13-02-iterators.html" iconsizing="both"><!---->/ch13-02-iterators.html<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/trpl-zh-cn/ch13-03-improving-our-io-project.html" aria-label="/ch13-03-improving-our-io-project.html" iconsizing="both"><!---->/ch13-03-improving-our-io-project.html<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/trpl-zh-cn/ch13-04-performance.html" aria-label="/ch13-04-performance.html" iconsizing="both"><!---->/ch13-04-performance.html<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/trpl-zh-cn/ch14-00-more-about-cargo.html" aria-label="进一步认识 Cargo 和 Crates.io" iconsizing="both"><!---->进一步认识 Cargo 和 Crates.io<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/trpl-zh-cn/ch14-01-release-profiles.html" aria-label="/ch14-01-release-profiles.html" iconsizing="both"><!---->/ch14-01-release-profiles.html<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/trpl-zh-cn/ch14-02-publishing-to-crates-io.html" aria-label="/ch14-02-publishing-to-crates-io.html" iconsizing="both"><!---->/ch14-02-publishing-to-crates-io.html<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/trpl-zh-cn/ch14-03-cargo-workspaces.html" aria-label="/ch14-03-cargo-workspaces.html" iconsizing="both"><!---->/ch14-03-cargo-workspaces.html<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/trpl-zh-cn/ch14-04-installing-binaries.html" aria-label="/ch14-04-installing-binaries.html" iconsizing="both"><!---->/ch14-04-installing-binaries.html<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/trpl-zh-cn/ch14-05-extending-cargo.html" aria-label="/ch14-05-extending-cargo.html" iconsizing="both"><!---->/ch14-05-extending-cargo.html<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/trpl-zh-cn/ch15-00-smart-pointers.html" aria-label="智能指针" iconsizing="both"><!---->智能指针<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/trpl-zh-cn/ch15-01-box.html" aria-label="/ch15-01-box.html" iconsizing="both"><!---->/ch15-01-box.html<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/trpl-zh-cn/ch15-02-deref.html" aria-label="/ch15-02-deref.html" iconsizing="both"><!---->/ch15-02-deref.html<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/trpl-zh-cn/ch15-03-drop.html" aria-label="/ch15-03-drop.html" iconsizing="both"><!---->/ch15-03-drop.html<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/trpl-zh-cn/ch15-04-rc.html" aria-label="/ch15-04-rc.html" iconsizing="both"><!---->/ch15-04-rc.html<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/trpl-zh-cn/ch15-05-interior-mutability.html" aria-label="/ch15-05-interior-mutability.html" iconsizing="both"><!---->/ch15-05-interior-mutability.html<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/trpl-zh-cn/ch15-06-reference-cycles.html" aria-label="/ch15-06-reference-cycles.html" iconsizing="both"><!---->/ch15-06-reference-cycles.html<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/trpl-zh-cn/ch16-00-concurrency.html" aria-label="无畏并发" iconsizing="both"><!---->无畏并发<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/trpl-zh-cn/ch16-01-threads.html" aria-label="/ch16-01-threads.html" iconsizing="both"><!---->/ch16-01-threads.html<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/trpl-zh-cn/ch16-02-message-passing.html" aria-label="/ch16-02-message-passing.html" iconsizing="both"><!---->/ch16-02-message-passing.html<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/trpl-zh-cn/ch16-03-shared-state.html" aria-label="/ch16-03-shared-state.html" iconsizing="both"><!---->/ch16-03-shared-state.html<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/trpl-zh-cn/ch16-04-extensible-concurrency-sync-and-send.html" aria-label="/ch16-04-extensible-concurrency-sync-and-send.html" iconsizing="both"><!---->/ch16-04-extensible-concurrency-sync-and-send.html<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/trpl-zh-cn/ch17-00-async-await.html" aria-label="Async 和 await" iconsizing="both"><!---->Async 和 await<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/trpl-zh-cn/ch17-01-futures-and-syntax.html" aria-label="/ch17-01-futures-and-syntax.html" iconsizing="both"><!---->/ch17-01-futures-and-syntax.html<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/trpl-zh-cn/ch17-02-concurrency-with-async.html" aria-label="/ch17-02-concurrency-with-async.html" iconsizing="both"><!---->/ch17-02-concurrency-with-async.html<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/trpl-zh-cn/ch17-03-more-futures.html" aria-label="/ch17-03-more-futures.html" iconsizing="both"><!---->/ch17-03-more-futures.html<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/trpl-zh-cn/ch17-04-streams.html" aria-label="/ch17-04-streams.html" iconsizing="both"><!---->/ch17-04-streams.html<!----></a></li><li><a class="route-link route-link-active auto-link vp-sidebar-link active" href="/trpl-zh-cn/ch17-05-traits-for-async.html" aria-label="/ch17-05-traits-for-async.html" iconsizing="both"><!---->/ch17-05-traits-for-async.html<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/trpl-zh-cn/ch17-06-futures-tasks-threads.html" aria-label="/ch17-06-futures-tasks-threads.html" iconsizing="both"><!---->/ch17-06-futures-tasks-threads.html<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/trpl-zh-cn/ch18-00-oop.html" aria-label="Rust 的面向对象特性" iconsizing="both"><!---->Rust 的面向对象特性<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/trpl-zh-cn/ch18-01-what-is-oo.html" aria-label="/ch18-01-what-is-oo.html" iconsizing="both"><!---->/ch18-01-what-is-oo.html<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/trpl-zh-cn/ch18-02-trait-objects.html" aria-label="/ch18-02-trait-objects.html" iconsizing="both"><!---->/ch18-02-trait-objects.html<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/trpl-zh-cn/ch18-03-oo-design-patterns.html" aria-label="/ch18-03-oo-design-patterns.html" iconsizing="both"><!---->/ch18-03-oo-design-patterns.html<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/trpl-zh-cn/ch19-00-patterns.html" aria-label="模式与模式匹配" iconsizing="both"><!---->模式与模式匹配<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/trpl-zh-cn/ch19-01-all-the-places-for-patterns.html" aria-label="/ch19-01-all-the-places-for-patterns.html" iconsizing="both"><!---->/ch19-01-all-the-places-for-patterns.html<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/trpl-zh-cn/ch19-02-refutability.html" aria-label="/ch19-02-refutability.html" iconsizing="both"><!---->/ch19-02-refutability.html<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/trpl-zh-cn/ch19-03-pattern-syntax.html" aria-label="/ch19-03-pattern-syntax.html" iconsizing="both"><!---->/ch19-03-pattern-syntax.html<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/trpl-zh-cn/ch20-00-advanced-features.html" aria-label="高级特性" iconsizing="both"><!---->高级特性<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/trpl-zh-cn/ch20-01-unsafe-rust.html" aria-label="/ch20-01-unsafe-rust.html" iconsizing="both"><!---->/ch20-01-unsafe-rust.html<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/trpl-zh-cn/ch20-03-advanced-traits.html" aria-label="/ch20-03-advanced-traits.html" iconsizing="both"><!---->/ch20-03-advanced-traits.html<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/trpl-zh-cn/ch20-04-advanced-types.html" aria-label="/ch20-04-advanced-types.html" iconsizing="both"><!---->/ch20-04-advanced-types.html<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/trpl-zh-cn/ch20-05-advanced-functions-and-closures.html" aria-label="/ch20-05-advanced-functions-and-closures.html" iconsizing="both"><!---->/ch20-05-advanced-functions-and-closures.html<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/trpl-zh-cn/ch20-06-macros.html" aria-label="/ch20-06-macros.html" iconsizing="both"><!---->/ch20-06-macros.html<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/trpl-zh-cn/ch21-00-final-project-a-web-server.html" aria-label="最后的项目：构建多线程 web server" iconsizing="both"><!---->最后的项目：构建多线程 web server<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/trpl-zh-cn/ch21-01-single-threaded.html" aria-label="/ch21-01-single-threaded.html" iconsizing="both"><!---->/ch21-01-single-threaded.html<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/trpl-zh-cn/ch21-02-multithreaded.html" aria-label="/ch21-02-multithreaded.html" iconsizing="both"><!---->/ch21-02-multithreaded.html<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/trpl-zh-cn/ch21-03-graceful-shutdown-and-cleanup.html" aria-label="/ch21-03-graceful-shutdown-and-cleanup.html" iconsizing="both"><!---->/ch21-03-graceful-shutdown-and-cleanup.html<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/trpl-zh-cn/foreword.html" aria-label="前言" iconsizing="both"><!---->前言<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/trpl-zh-cn/PREFACE.html" aria-label="Rust 程序设计语言（第二版 &amp; 2018 edition）简体中文版" iconsizing="both"><!---->Rust 程序设计语言（第二版 &amp; 2018 edition）简体中文版<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/trpl-zh-cn/SUMMARY.html" aria-label="Rust 程序设计语言" iconsizing="both"><!---->Rust 程序设计语言<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/trpl-zh-cn/title-page.html" aria-label="Rust 程序设计语言" iconsizing="both"><!---->Rust 程序设计语言<!----></a></li></ul><!----></aside><!--[--><main id="main-content" class="vp-page"><!--[--><!----><!----><nav class="vp-breadcrumb disable"></nav><div class="vp-page-title"><h1><!---->ch17-05-traits-for-async</h1><!----><hr></div><!----><!----><div class="theme-hope-content" vp-content><h2 id="深入理解-async-相关的-traits" tabindex="-1"><a class="header-anchor" href="#深入理解-async-相关的-traits"><span>深入理解 async 相关的 traits</span></a></h2><blockquote><p><a href="https://github.com/rust-lang/book/blob/main/src/ch17-05-traits-for-async.md" target="_blank" rel="noopener noreferrer">ch17-05-traits-for-async.md</a><br><br><br> commit 56ec353290429e6547109e88afea4de027b0f1a9</p></blockquote><p>贯穿本章，我们通过多种方式使用了 <code>Future</code>、<code>Pin</code>、<code>Unpin</code>、<code>Stream</code> 和 <code>StreamExt</code> trait。但是直到目前为止，我们避免过多地了解它们如何工作或者如何组合在一起的细节，这对你日常的 Rust 开发而言通常是没问题的。不过有时你会遇到需要了解更多细节的场景。在本小节，我们会足够深入以便理解这些场景，并仍会将 <em>真正</em> 有深度的内容留给其它文档。</p><h3 id="future-trait" tabindex="-1"><a class="header-anchor" href="#future-trait"><span><code>Future</code> trait</span></a></h3><p>让我们以更深入地了解 <code>Future</code> trait 作为开始。这里是 Rust 中其如何定义的：</p><div class="language-rust line-numbers-mode" data-highlighter="shiki" data-ext="rust" data-title="rust" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">use</span><span style="--shiki-light:#383A42;--shiki-dark:#E5C07B;"> std</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">::</span><span style="--shiki-light:#383A42;--shiki-dark:#E5C07B;">pin</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">::</span><span style="--shiki-light:#0184BC;--shiki-dark:#E5C07B;">Pin</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">use</span><span style="--shiki-light:#383A42;--shiki-dark:#E5C07B;"> std</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">::</span><span style="--shiki-light:#383A42;--shiki-dark:#E5C07B;">task</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">::{</span><span style="--shiki-light:#0184BC;--shiki-dark:#E5C07B;">Context</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#0184BC;--shiki-dark:#E5C07B;">Poll</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">};</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">pub</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> trait</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> Future</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    type</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> Output</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    fn</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> poll</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">self</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#0184BC;--shiki-dark:#E5C07B;">Pin</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&lt;&amp;</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">mut</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;"> Self</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;, </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">cx</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: &amp;</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">mut</span><span style="--shiki-light:#0184BC;--shiki-dark:#E5C07B;"> Context</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&lt;&#39;</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">_</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;) -&gt; </span><span style="--shiki-light:#0184BC;--shiki-dark:#E5C07B;">Poll</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">Self</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">::</span><span style="--shiki-light:#0184BC;--shiki-dark:#E5C07B;">Output</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>trait 定义中包含一些的新类型和我们之前没有见过新语法，所以让我们逐步详细地解析一下这个定义。</p><p>首先， <code>Future</code> 的关联类型 <code>Output</code> 表明 future 最终解析出的类型。这类似于 <code>Iterator</code> trait 的关联类型 <code>Item</code>。其次，<code>Future</code> 还有一个 <code>poll</code> 方法，其有一个特殊的 <code>self</code> 参数的 <code>Pin</code> 引用和一个 <code>Context</code> 类型的可变引用，并返回一个 <code>Poll&lt;Self::Output&gt;</code>。稍后我们再细说 <code>Pin</code> 和 <code>Context</code>。现在让我们专注于方法返回的 <code>Poll</code> 类型：</p><div class="language-rust line-numbers-mode" data-highlighter="shiki" data-ext="rust" data-title="rust" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">enum</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> Poll</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#0184BC;--shiki-dark:#E5C07B;">T</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt; {</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">    Ready</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#0184BC;--shiki-dark:#E5C07B;">T</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">),</span></span>
<span class="line"><span style="--shiki-light:#0184BC;--shiki-dark:#E5C07B;">    Pending</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><code>Poll</code> 类型类似于一个 <code>Option</code>。它有一个包含值的变体 <code>Ready(T)</code>，和一个没有值的变体 <code>Pending</code>。不过 <code>Poll</code> 所代表的意义与 <code>Option</code> 非常不同！<code>Pending</code> 变体表明 future 仍然还有工作要进行，所有调用者稍后需要再次检查。<code>Ready</code> 变体表明 future 已经完成了其工作并且 <code>T</code> 的值是可用的。</p><blockquote><p>注意：对于大部分功能，调用者不应在 future 返回 <code>Ready</code> 后再次调用 <code>poll</code>。很多 future 在完成后再次轮询会 panic。可以安全地再次轮询的 future 会在文档中显示地说明。这类似于 <code>Iterator::next</code> 的行为。</p></blockquote><p>当你见到使用 <code>await</code> 的代码时，Rust 会在底层将其编译为调用 <code>poll</code> 的代码。如果你回头看下示例 17-4，其在一个单个 URL 解析完成后打印出页面标题，Rust 将其编译为一些类似（虽然不完全是）这样的代码：</p><div class="language-rust,ignore line-numbers-mode" data-highlighter="shiki" data-ext="rust,ignore" data-title="rust,ignore" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>match page_title(url).poll() {</span></span>
<span class="line"><span>    Ready(page_title) =&gt; match page_title {</span></span>
<span class="line"><span>        Some(title) =&gt; println!(&quot;The title for {url} was {title}&quot;),</span></span>
<span class="line"><span>        None =&gt; println!(&quot;{url} had no title&quot;),</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span>    Pending =&gt; {</span></span>
<span class="line"><span>        // But what goes here?</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span>}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>如果 future 仍然是 <code>Pending</code> 的话我们应该做什么呢？我们需要某种方式不断重试，直到 future 最终准备好。换句话说，我们需要一个循环：</p><div class="language-rust,ignore line-numbers-mode" data-highlighter="shiki" data-ext="rust,ignore" data-title="rust,ignore" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>let mut page_title_fut = page_title(url);</span></span>
<span class="line"><span>loop {</span></span>
<span class="line"><span>    match page_title_fut.poll() {</span></span>
<span class="line"><span>        Ready(value) =&gt; match page_title {</span></span>
<span class="line"><span>            Some(title) =&gt; println!(&quot;The title for {url} was {title}&quot;),</span></span>
<span class="line"><span>            None =&gt; println!(&quot;{url} had no title&quot;),</span></span>
<span class="line"><span>        }</span></span>
<span class="line"><span>        Pending =&gt; {</span></span>
<span class="line"><span>            // continue</span></span>
<span class="line"><span>        }</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span>}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>不过，如果 Rust 真的将代码精确地编译成那样，那么每一个 <code>await</code> 都会变成阻塞操作 -- 这恰恰与我们的目标相反！相反，Rust 确保循环可以将控制权交给一些可以暂停当前 future 转而去处理其它 future 并在之后再次检查当前 future 的内容。如你所见，这就是异步运行时，这种安排和协调的工作是其主要工作之一。</p><p>在本章前面的内容中，我们描述了等待 <code>rx.recv</code>。<code>recv</code> 调用返回一个 future，并 await 轮询它的 future。我们注意到当信道关闭时运行时会暂停 future 直到它就绪并返回 <code>Some(message)</code> 或 <code>None</code> 为止。随着我们对 <code>Future</code> trait，尤其是 <code>Future::poll</code> 的理解的深入，我们可以看出其是如何工作的。运行时知道 future 返回 <code>Poll::Pending</code> 时它还没有完成。反过来说，当 <code>poll</code> 返回 <code>Poll::Ready(Some(message))</code> 或 <code>Poll::Ready(None)</code> 时运行时知道 future <strong>已经</strong>完成了并继续运行。</p><p>运行时如何工作的具体细节超出了本书的范畴。不过关键在于理解 future 的基本机制：运行时<strong>轮询</strong>其所负责的每一个 future，在它们还没有完成时使其休眠。</p><h3 id="pin-和-unpin-traits" tabindex="-1"><a class="header-anchor" href="#pin-和-unpin-traits"><span><code>Pin</code> 和 <code>Unpin</code> traits</span></a></h3><p>当我们在示例 17-16 中引入 pin 的概念时，我们遇到了一个很不友好的错误信息。这里再次展示其中相关的部分：</p><!-- manual-regeneration
cd listings/ch17-async-await/listing-17-16
cargo build
copy *only* the final `error` block from the errors
--><div class="language-text line-numbers-mode" data-highlighter="shiki" data-ext="text" data-title="text" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>error[E0277]: `{async block@src/main.rs:10:23: 10:33}` cannot be unpinned</span></span>
<span class="line"><span>  --&gt; src/main.rs:48:33</span></span>
<span class="line"><span>   |</span></span>
<span class="line"><span>48 |         trpl::join_all(futures).await;</span></span>
<span class="line"><span>   |                                 ^^^^^ the trait `Unpin` is not implemented for `{async block@src/main.rs:10:23: 10:33}`</span></span>
<span class="line"><span>   |</span></span>
<span class="line"><span>   = note: consider using the `pin!` macro</span></span>
<span class="line"><span>           consider using `Box::pin` if you need to access the pinned value outside of the current scope</span></span>
<span class="line"><span>   = note: required for `Box&lt;{async block@src/main.rs:10:23: 10:33}&gt;` to implement `Future`</span></span>
<span class="line"><span>note: required by a bound in `futures_util::future::join_all::JoinAll`</span></span>
<span class="line"><span>  --&gt; file:///home/.cargo/registry/src/index.crates.io-1949cf8c6b5b557f/futures-util-0.3.30/src/future/join_all.rs:29:8</span></span>
<span class="line"><span>   |</span></span>
<span class="line"><span>27 | pub struct JoinAll&lt;F&gt;</span></span>
<span class="line"><span>   |            ------- required by a bound in this struct</span></span>
<span class="line"><span>28 | where</span></span>
<span class="line"><span>29 |     F: Future,</span></span>
<span class="line"><span>   |        ^^^^^^ required by this bound in `JoinAll`</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>这个错误信息不仅告诉我们需要对这些值进行 pin 操作，还解释了为什么 pin 是必要的。<code>trpl::join_all</code> 函数返回一个叫做 <code>JoinAll</code> 的结构体。这个结构体是一个 <code>F</code> 类型的泛型，它被限制为需要实现 <code>Future</code> trait。通过 <code>await</code> 直接 await 一个 future 会隐式地 pin 住这个函数。这也就是为什么我们不需要在任何想要 await future 的地方使用 <code>pin!</code>。</p><p>然而，这里我们没有直接 await 一个 future。相反我们通过向 <code>join_all</code> 函数传递一个 future 集合来构建了一个新 future <code>JoinAll</code>。<code>join_all</code> 的签名要求集合中项的类型都要实现 <code>Future</code> trait，而 <code>Box&lt;T&gt;</code> 只有在其封装的 <code>T</code> 是一个实现了 <code>Unpin</code> trait 的 future 时才会实现 <code>Future</code>。</p><p>这有很多需要吸收的知识！为了真正地理解它，让我们稍微深入理解 <code>Future</code> 实际上是如何工作的，特别是 <em>pinning</em> 那一部分。</p><p>再次观察 <code>Future</code> trait 的定义：</p><div class="language-rust line-numbers-mode" data-highlighter="shiki" data-ext="rust" data-title="rust" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">use</span><span style="--shiki-light:#383A42;--shiki-dark:#E5C07B;"> std</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">::</span><span style="--shiki-light:#383A42;--shiki-dark:#E5C07B;">pin</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">::</span><span style="--shiki-light:#0184BC;--shiki-dark:#E5C07B;">Pin</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">use</span><span style="--shiki-light:#383A42;--shiki-dark:#E5C07B;"> std</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">::</span><span style="--shiki-light:#383A42;--shiki-dark:#E5C07B;">task</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">::{</span><span style="--shiki-light:#0184BC;--shiki-dark:#E5C07B;">Context</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#0184BC;--shiki-dark:#E5C07B;">Poll</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">};</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">pub</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> trait</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> Future</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    type</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> Output</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">    // Required method</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    fn</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> poll</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">self</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#0184BC;--shiki-dark:#E5C07B;">Pin</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&lt;&amp;</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">mut</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;"> Self</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;, </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">cx</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: &amp;</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">mut</span><span style="--shiki-light:#0184BC;--shiki-dark:#E5C07B;"> Context</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&lt;&#39;</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">_</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;) -&gt; </span><span style="--shiki-light:#0184BC;--shiki-dark:#E5C07B;">Poll</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">Self</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">::</span><span style="--shiki-light:#0184BC;--shiki-dark:#E5C07B;">Output</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>这里的 <code>cx</code> 参数及其 <code>Context</code> 类型，是运行时如何在仍保持 lazy 的情况下实际知道何时去检查任何给定的 future 的关键。同样，它们是如何工作的细节超出了本章的范畴，通常你只有在编写自定义 <code>Future</code> 实现时才需要思考它。相反我们将关注 <code>self</code> 的类型，因为这是第一次见到 <code>self</code> 有类型注解的方法。<code>self</code> 的类型注解与其它参数的类型注解类似，但有两个关键区别：</p><ul><li>它告诉 Rust 在调用该方法时 <code>self</code> 必须具备的类型。</li><li>它不能是任意类型。这限制了实现了该方法的类型，是一个该类型的引用或者智能指针，或者一个封装了该类型引用的 <code>Pin</code>。</li></ul><p>我们会在 <a class="route-link" href="/trpl-zh-cn/ch18-00-oop.html">第十八章</a> 更多地看到这个语法。现在，知道如果要轮询一个 future 来检查它是 <code>Pending</code> 或者 <code>Ready(Output)</code>，我们需要一个 <code>Pin</code> 封装的该类型的可变引用就够了。</p><p><code>Pin</code> 是一个类指针类型的封装，比如 <code>&amp;</code>，<code>&amp;mut</code>，<code>Box</code> 和 <code>Rc</code>。（从技术上来说，<code>Pin</code> 适用于实现了 <code>Deref</code> 或 <code>DerefMut</code> trait 的类型，不过这实际上等同于只能适用于指针。）<code>Pin</code> 本身并不是一个指针并且也不具备类似 <code>Rc</code> 和 <code>Arc</code> 那样引用技术的功能；它单纯地是一个编译器可以用来约束指针使用的工具。</p><p>回忆一下 <code>await</code> 的实现是基于对 <code>poll</code> 的调用，这有助于解释之前见到的错误信息，不过那是关于 <code>Unpin</code> 的。所以 <code>Pin</code> 具体与 <code>Unpin</code> 有何关联，又为什么 <code>Future</code> 需要 <code>self</code> 在一个 <code>Pin</code> 类型中才能调用 <code>poll</code>？</p><p>回忆一下本章之前 future 中一系列的 await point 被编译为一个状态机，而编译器确保这个状态机遵守所有 Rust 在安全方面的正常规则，包括借用和所有权。为了使其正常工作，Rust 检查在一个 await point 和另一个 await point 之间或到异步代码块结尾之间什么数据是需要的。它接着在编译的状态机中创建一个相应的变体。每一个变体获得其在源码中对应片段所用到的数据的访问权限，要么获取数据的所有权要么获取其可变或不可变引用。</p><p>到目前为止, 一切正常：如果你在给定异步代码块中搞错了所有权或者引用，借用检查器会告诉你。当我们需要移动对应代码块的 future -- 例如将其移动到 <code>Vec</code> 中或者传递给 <code>join_all</code> -- 事情就会变得棘手。</p><p>当我们移动一个 future -- 将其移动进一个数据结构通过 <code>join_all</code> 将其用作迭代器或者将其从函数返回 -- 这实际上意味着将 Rust 创建的状态机移动给我们。同时不同于 Rust 中大部分其它类型，Rust 为异步代码块创建的 future 可能最终会在任意给定变体的字段中有其自身的引用，如图 17-4 中的简化图所示。</p><figure><img alt="A single-column, three-row table representing a future, fut1, which has data values 0 and 1 in the first two rows and an arrow pointing from the third row back to the second row, representing an internal reference within the future." src="data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiIHN0YW5kYWxvbmU9Im5vIj8+CjwhRE9DVFlQRSBzdmcgUFVCTElDICItLy9XM0MvL0RURCBTVkcgMS4xLy9FTiIKICJodHRwOi8vd3d3LnczLm9yZy9HcmFwaGljcy9TVkcvMS4xL0RURC9zdmcxMS5kdGQiPgo8IS0tIEdlbmVyYXRlZCBieSBncmFwaHZpeiB2ZXJzaW9uIDEyLjEuMSAoMjAyNDA5MTAuMDA1MykKIC0tPgo8IS0tIFBhZ2VzOiAxIC0tPgo8c3ZnIGhlaWdodD0iMTUwcHQiCiB2aWV3Qm94PSIwLjAwIDAuMDAgMzcxLjAwIDQ0Mi4wMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB4bWxuczp4bGluaz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayI+CjxnIGlkPSJncmFwaDAiIGNsYXNzPSJncmFwaCIgdHJhbnNmb3JtPSJzY2FsZSg0LjE2NjY3IDQuMTY2NjcpIHJvdGF0ZSgwKSB0cmFuc2xhdGUoNCAxMDIpIj4KPHBvbHlnb24gZmlsbD0id2hpdGUiIHN0cm9rZT0ibm9uZSIgcG9pbnRzPSItNCw0IC00LC0xMDIgODUsLTEwMiA4NSw0IC00LDQiLz4KPCEtLSBmdXQxIC0tPgo8ZyBpZD0ibm9kZTEiIGNsYXNzPSJub2RlIj4KPHRpdGxlPmZ1dDE8L3RpdGxlPgo8cG9seWxpbmUgZmlsbD0ibm9uZSIgc3Ryb2tlPSJibGFjayIgcG9pbnRzPSIxMy4xMiwtNzEuNSA0MC44OCwtNzEuNSIvPgo8dGV4dCB0ZXh0LWFuY2hvcj0ic3RhcnQiIHg9IjE2LjEyIiB5PSItNzcuNyIgZm9udC1mYW1pbHk9IlRpbWVzLHNlcmlmIiBmb250LXNpemU9IjE0LjAwIj5mdXQxPC90ZXh0Pgo8cG9seWdvbiBmaWxsPSJub25lIiBzdHJva2U9ImJsYWNrIiBwb2ludHM9IjEzLjEyLC00OSAxMy4xMiwtNzEuNSA0MC44OCwtNzEuNSA0MC44OCwtNDkgMTMuMTIsLTQ5Ii8+Cjx0ZXh0IHRleHQtYW5jaG9yPSJzdGFydCIgeD0iMjMuNjIiIHk9Ii01NS4yIiBmb250LWZhbWlseT0iVGltZXMsc2VyaWYiIGZvbnQtc2l6ZT0iMTQuMDAiPjA8L3RleHQ+Cjxwb2x5Z29uIGZpbGw9Im5vbmUiIHN0cm9rZT0iYmxhY2siIHBvaW50cz0iMTMuMTIsLTI2LjUgMTMuMTIsLTQ5IDQwLjg4LC00OSA0MC44OCwtMjYuNSAxMy4xMiwtMjYuNSIvPgo8dGV4dCB0ZXh0LWFuY2hvcj0ic3RhcnQiIHg9IjIzLjYyIiB5PSItMzIuNyIgZm9udC1mYW1pbHk9IlRpbWVzLHNlcmlmIiBmb250LXNpemU9IjE0LjAwIj4xPC90ZXh0Pgo8cG9seWdvbiBmaWxsPSJub25lIiBzdHJva2U9ImJsYWNrIiBwb2ludHM9IjEzLjEyLC00IDEzLjEyLC0yNi41IDQwLjg4LC0yNi41IDQwLjg4LC00IDEzLjEyLC00Ii8+Cjx0ZXh0IHRleHQtYW5jaG9yPSJzdGFydCIgeD0iMjMuMjUiIHk9Ii0xMC4yIiBmb250LWZhbWlseT0iVGltZXMsc2VyaWYiIGZvbnQtc2l6ZT0iMTQuMDAiPiAmIzE2MDs8L3RleHQ+CjwvZz4KPCEtLSBmdXQxJiM0NTsmZ3Q7ZnV0MSAtLT4KPGcgaWQ9ImVkZ2UxIiBjbGFzcz0iZWRnZSI+Cjx0aXRsZT5mdXQxOmMmIzQ1OyZndDtmdXQxOnRhcmdldDwvdGl0bGU+CjxwYXRoIGZpbGw9Im5vbmUiIHN0cm9rZT0iYmxhY2siIGQ9Ik0yNywtMTUuMjVDNDUsLTYuMjUgODEsLTYuMjUgODEsLTI2LjUgODEsLTM5LjExIDY3LjA1LC00My44NyA1Mi4xNywtNDMuNDkiLz4KPHBvbHlnb24gZmlsbD0iYmxhY2siIHN0cm9rZT0iYmxhY2siIHBvaW50cz0iNTIuNjYsLTQwLjAyIDQyLjM0LC00Mi40MSA1MS44OSwtNDYuOTggNTIuNjYsLTQwLjAyIi8+CjwvZz4KPC9nPgo8L3N2Zz4K" class="center"><figcaption>图 17-4: 一个自引用数据类型。</figcaption></figure><p>但是，默认移动任何拥有其自身引用的对象是不安全（unsafe）的，因为引用总是会指向任何其引用数据的实际内存地址（见图 17-5）。如果我们移动数据结构本身，这些内部引用会停留在指向老的地址。然后，这些内存地址现在是无效的。一方面，当修改这些数据结构时这些值不会被更新。另一个更重要的方面是，电脑现在可以随意复用这些内存用于其它用途！之后你最终可能会读取到完全不相关的数据。</p><figure><img alt="Two tables, depicting two futures, fut1 and fut2, each of which has one column and three rows, representing the result of having moved a future out of fut1 into fut2. The first, fut1, is grayed out, with a question mark in each index, representing unknown memory. The second, fut2, has 0 and 1 in the first and second rows and an arrow pointing from its third row back to the second row of fut1, representing a pointer that is referencing the old location in memory of the future before it was moved." src="data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiIHN0YW5kYWxvbmU9Im5vIj8+CjwhRE9DVFlQRSBzdmcgUFVCTElDICItLy9XM0MvL0RURCBTVkcgMS4xLy9FTiIKICJodHRwOi8vd3d3LnczLm9yZy9HcmFwaGljcy9TVkcvMS4xL0RURC9zdmcxMS5kdGQiPgo8IS0tIEdlbmVyYXRlZCBieSBncmFwaHZpeiB2ZXJzaW9uIDEyLjEuMSAoMjAyNDA5MTAuMDA1MykKIC0tPgo8IS0tIFBhZ2VzOiAxIC0tPgo8c3ZnIGhlaWdodD0iMjAwcHQiCiB2aWV3Qm94PSIwLjAwIDAuMDAgNzY3LjAwIDU3NS4wMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB4bWxuczp4bGluaz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayI+CjxnIGlkPSJncmFwaDAiIGNsYXNzPSJncmFwaCIgdHJhbnNmb3JtPSJzY2FsZSg0LjE2NjY3IDQuMTY2NjcpIHJvdGF0ZSgwKSB0cmFuc2xhdGUoNCAxMzQpIj4KPHBvbHlnb24gZmlsbD0id2hpdGUiIHN0cm9rZT0ibm9uZSIgcG9pbnRzPSItNCw0IC00LC0xMzQgMTgwLC0xMzQgMTgwLDQgLTQsNCIvPgo8ZyBpZD0iY2x1c3QxIiBjbGFzcz0iY2x1c3RlciI+Cjx0aXRsZT4lMzwvdGl0bGU+CjwvZz4KPCEtLSBmdXQxIC0tPgo8ZyBpZD0ibm9kZTEiIGNsYXNzPSJub2RlIj4KPHRpdGxlPmZ1dDE8L3RpdGxlPgo8cG9seWdvbiBmaWxsPSJncmF5IiBzdHJva2U9Im5vbmUiIHBvaW50cz0iMjkuMTIsLTIwIDI5LjEyLC0xMTAgNTYuODgsLTExMCA1Ni44OCwtMjAgMjkuMTIsLTIwIi8+Cjxwb2x5bGluZSBmaWxsPSJub25lIiBzdHJva2U9ImJsYWNrIiBwb2ludHM9IjI5LjEyLC04Ny41IDU2Ljg4LC04Ny41Ii8+Cjx0ZXh0IHRleHQtYW5jaG9yPSJzdGFydCIgeD0iMzIuMTIiIHk9Ii05My43IiBmb250LWZhbWlseT0iVGltZXMsc2VyaWYiIGZvbnQtc2l6ZT0iMTQuMDAiPmZ1dDE8L3RleHQ+Cjxwb2x5Z29uIGZpbGw9Im5vbmUiIHN0cm9rZT0iYmxhY2siIHBvaW50cz0iMjkuMTIsLTY1IDI5LjEyLC04Ny41IDU2Ljg4LC04Ny41IDU2Ljg4LC02NSAyOS4xMiwtNjUiLz4KPHRleHQgdGV4dC1hbmNob3I9InN0YXJ0IiB4PSI0MCIgeT0iLTcxLjIiIGZvbnQtZmFtaWx5PSJUaW1lcyxzZXJpZiIgZm9udC1zaXplPSIxNC4wMCI+PzwvdGV4dD4KPHBvbHlnb24gZmlsbD0ibm9uZSIgc3Ryb2tlPSJibGFjayIgcG9pbnRzPSIyOS4xMiwtNDIuNSAyOS4xMiwtNjUgNTYuODgsLTY1IDU2Ljg4LC00Mi41IDI5LjEyLC00Mi41Ii8+Cjx0ZXh0IHRleHQtYW5jaG9yPSJzdGFydCIgeD0iNDAiIHk9Ii00OC43IiBmb250LWZhbWlseT0iVGltZXMsc2VyaWYiIGZvbnQtc2l6ZT0iMTQuMDAiPj88L3RleHQ+Cjxwb2x5Z29uIGZpbGw9Im5vbmUiIHN0cm9rZT0iYmxhY2siIHBvaW50cz0iMjkuMTIsLTIwIDI5LjEyLC00Mi41IDU2Ljg4LC00Mi41IDU2Ljg4LC0yMCAyOS4xMiwtMjAiLz4KPHRleHQgdGV4dC1hbmNob3I9InN0YXJ0IiB4PSI0MCIgeT0iLTI2LjIiIGZvbnQtZmFtaWx5PSJUaW1lcyxzZXJpZiIgZm9udC1zaXplPSIxNC4wMCI+PzwvdGV4dD4KPC9nPgo8IS0tIGZ1dDIgLS0+CjxnIGlkPSJub2RlMiIgY2xhc3M9Im5vZGUiPgo8dGl0bGU+ZnV0MjwvdGl0bGU+Cjxwb2x5bGluZSBmaWxsPSJub25lIiBzdHJva2U9ImJsYWNrIiBwb2ludHM9IjExOS4xMiwtODcuNSAxNDYuODgsLTg3LjUiLz4KPHRleHQgdGV4dC1hbmNob3I9InN0YXJ0IiB4PSIxMjIuMTIiIHk9Ii05My43IiBmb250LWZhbWlseT0iVGltZXMsc2VyaWYiIGZvbnQtc2l6ZT0iMTQuMDAiPmZ1dDI8L3RleHQ+Cjxwb2x5Z29uIGZpbGw9Im5vbmUiIHN0cm9rZT0iYmxhY2siIHBvaW50cz0iMTE5LjEyLC02NSAxMTkuMTIsLTg3LjUgMTQ2Ljg4LC04Ny41IDE0Ni44OCwtNjUgMTE5LjEyLC02NSIvPgo8dGV4dCB0ZXh0LWFuY2hvcj0ic3RhcnQiIHg9IjEyOS42MiIgeT0iLTcxLjIiIGZvbnQtZmFtaWx5PSJUaW1lcyxzZXJpZiIgZm9udC1zaXplPSIxNC4wMCI+MDwvdGV4dD4KPHBvbHlnb24gZmlsbD0ibm9uZSIgc3Ryb2tlPSJibGFjayIgcG9pbnRzPSIxMTkuMTIsLTQyLjUgMTE5LjEyLC02NSAxNDYuODgsLTY1IDE0Ni44OCwtNDIuNSAxMTkuMTIsLTQyLjUiLz4KPHRleHQgdGV4dC1hbmNob3I9InN0YXJ0IiB4PSIxMjkuNjIiIHk9Ii00OC43IiBmb250LWZhbWlseT0iVGltZXMsc2VyaWYiIGZvbnQtc2l6ZT0iMTQuMDAiPjE8L3RleHQ+Cjxwb2x5Z29uIGZpbGw9Im5vbmUiIHN0cm9rZT0iYmxhY2siIHBvaW50cz0iMTE5LjEyLC0yMCAxMTkuMTIsLTQyLjUgMTQ2Ljg4LC00Mi41IDE0Ni44OCwtMjAgMTE5LjEyLC0yMCIvPgo8dGV4dCB0ZXh0LWFuY2hvcj0ic3RhcnQiIHg9IjEzMS4xMiIgeT0iLTI2LjIiIGZvbnQtZmFtaWx5PSJUaW1lcyxzZXJpZiIgZm9udC1zaXplPSIxNC4wMCI+IDwvdGV4dD4KPC9nPgo8IS0tIGZ1dDImIzQ1OyZndDtmdXQxIC0tPgo8ZyBpZD0iZWRnZTEiIGNsYXNzPSJlZGdlIj4KPHRpdGxlPmZ1dDI6YyYjNDU7Jmd0O2Z1dDE6YzwvdGl0bGU+CjxwYXRoIGZpbGw9Im5vbmUiIHN0cm9rZT0iYmxhY2siIGQ9Ik0xMzIsLTMxLjI1QzEzMiwtMzEuMjUgOTMuNiwtNDEuMDcgNjcuNTQsLTQ3LjczIi8+Cjxwb2x5Z29uIGZpbGw9ImJsYWNrIiBzdHJva2U9ImJsYWNrIiBwb2ludHM9IjY2LjksLTQ0LjI4IDU4LjA3LC01MC4xNSA2OC42MywtNTEuMDcgNjYuOSwtNDQuMjgiLz4KPC9nPgo8L2c+Cjwvc3ZnPgo=" class="center"><figcaption>图 17-5: 移动一个自引用数据类型的不安全结果。</figcaption></figure><p>理论上来说，Rust 编译器也可以在对象被移动时尝试更新其所有的引用，不过这会增加很多性能开销，特别是在有一整个网状的引用需要更新的时候。相反如果我们确保相关的数据结构<strong>不能再内存中移动</strong>，我们就无需更新任何引用。这正是 Rust 的借用检查器所要求的：在安全代码中，禁止移动任何有自身活动引用的项。</p><p>构建于这之上的 <code>Pin</code> 正好给了我们所需的保证。当我们通过 <code>Pin</code> 封装一个值的引用来 <strong>pin</strong> 住它时，它就不能再移动了。也就是说，如果有 <code>Pin&lt;Box&lt;SomeType&gt;&gt;</code>，你实际上 ping 住了 <code>SomeType</code> 的值，而<strong>不是</strong> <code>Box</code> 指针。图 17-6 解释了这一过程。</p><figure><img alt="Three boxes laid out side by side. The first is labeled “Pin”, the second “b1”, and the third “pinned”. Within “pinned” is a table labeled “fut”, with a single column; it represents a future with cells for each part of the data structure. Its first cell has the value “0”, its second cell has an arrow coming out of it and pointing to the fourth and final cell, which has the value “1” in it, and the third cell has dashed lines and an ellipsis to indicate there may be other parts to the data structure. All together, the “fut” table represents a future which is self-referential. An arrow leaves the box labeled “Pin”, goes through the box labeled “b1” and has terminates inside the “pinned” box at the “fut” table." src="data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiIHN0YW5kYWxvbmU9Im5vIj8+CjwhRE9DVFlQRSBzdmcgUFVCTElDICItLy9XM0MvL0RURCBTVkcgMS4xLy9FTiIKICJodHRwOi8vd3d3LnczLm9yZy9HcmFwaGljcy9TVkcvMS4xL0RURC9zdmcxMS5kdGQiPgo8IS0tIEdlbmVyYXRlZCBieSBncmFwaHZpeiB2ZXJzaW9uIDEyLjEuMSAoMjAyNDA5MTAuMDA1MykKIC0tPgo8IS0tIFBhZ2VzOiAxIC0tPgo8c3ZnIGhlaWdodD0iMjAwcHQiCiB2aWV3Qm94PSIwLjAwIDAuMDAgOTA2IDc3MS4wMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB4bWxuczp4bGluaz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayI+CjxnIGlkPSJncmFwaDAiIGNsYXNzPSJncmFwaCIgdHJhbnNmb3JtPSJzY2FsZSg0LjE2NjY3IDQuMTY2NjcpIHJvdGF0ZSgwKSB0cmFuc2xhdGUoNCAxODEpIj4KPHBvbHlnb24gZmlsbD0id2hpdGUiIHN0cm9rZT0ibm9uZSIgcG9pbnRzPSItNCw0IC00LC0xODEgMjEzLjUsLTE4MSAyMTMuNSw0IC00LDQiLz4KPGcgaWQ9ImNsdXN0MSIgY2xhc3M9ImNsdXN0ZXIiPgo8dGl0bGU+Y2x1c3Rlcl9ib3g8L3RpdGxlPgo8L2c+CjxnIGlkPSJjbHVzdDIiIGNsYXNzPSJjbHVzdGVyIj4KPHRpdGxlPmNsdXN0ZXJfYm94X2ludGVybmFsPC90aXRsZT4KPHBvbHlnb24gZmlsbD0ibm9uZSIgc3Ryb2tlPSJibGFjayIgcG9pbnRzPSI4MiwtODggODIsLTEzMiAxMTEuNSwtMTMyIDExMS41LC04OCA4MiwtODgiLz4KPHRleHQgdGV4dC1hbmNob3I9Im1pZGRsZSIgeD0iOTYuNzUiIHk9Ii0xMTQuNyIgZm9udC1mYW1pbHk9IlRpbWVzLHNlcmlmIiBmb250LXNpemU9IjE0LjAwIj5iMTwvdGV4dD4KPC9nPgo8ZyBpZD0iY2x1c3QzIiBjbGFzcz0iY2x1c3RlciI+Cjx0aXRsZT5jbHVzdGVyX2RlcmVmPC90aXRsZT4KPHBvbHlnb24gZmlsbD0ibm9uZSIgc3Ryb2tlPSJibGFjayIgc3Ryb2tlLXdpZHRoPSIyIiBwb2ludHM9IjEzMS41LC04IDEzMS41LC0xNjkgMjAxLjUsLTE2OSAyMDEuNSwtOCAxMzEuNSwtOCIvPgo8dGV4dCB0ZXh0LWFuY2hvcj0ibWlkZGxlIiB4PSIxNjYuNSIgeT0iLTE1MS43IiBmb250LWZhbWlseT0iVGltZXMsc2VyaWYiIGZvbnQtc2l6ZT0iMTQuMDAiPnBpbm5lZDwvdGV4dD4KPC9nPgo8IS0tIHBpbm5lZF9ib3ggLS0+CjxnIGlkPSJub2RlMSIgY2xhc3M9Im5vZGUiPgo8dGl0bGU+cGlubmVkX2JveDwvdGl0bGU+Cjxwb2x5bGluZSBmaWxsPSJub25lIiBzdHJva2U9ImJsYWNrIiBwb2ludHM9IjE1LC0xMDkgMzksLTEwOSIvPgo8dGV4dCB0ZXh0LWFuY2hvcj0ic3RhcnQiIHg9IjE4IiB5PSItMTE1LjIiIGZvbnQtZmFtaWx5PSJUaW1lcyxzZXJpZiIgZm9udC1zaXplPSIxNC4wMCI+UGluPC90ZXh0Pgo8cG9seWdvbiBmaWxsPSJub25lIiBzdHJva2U9ImJsYWNrIiBwb2ludHM9IjE1LC04Ni41IDE1LC0xMDkgMzksLTEwOSAzOSwtODYuNSAxNSwtODYuNSIvPgo8dGV4dCB0ZXh0LWFuY2hvcj0ic3RhcnQiIHg9IjI1LjEyIiB5PSItOTIuNyIgZm9udC1mYW1pbHk9IlRpbWVzLHNlcmlmIiBmb250LXNpemU9IjE0LjAwIj4gPC90ZXh0Pgo8L2c+CjwhLS0gcGluIC0tPgo8ZyBpZD0ibm9kZTIiIGNsYXNzPSJub2RlIj4KPHRpdGxlPnBpbjwvdGl0bGU+CjxlbGxpcHNlIGZpbGw9ImJsYWNrIiBzdHJva2U9ImJsYWNrIiBjeD0iOTYuMjUiIGN5PSItOTgiIHJ4PSIxLjgiIHJ5PSIxLjgiLz4KPC9nPgo8IS0tIHBpbm5lZF9ib3gmIzQ1OyZndDtwaW4gLS0+CjxnIGlkPSJlZGdlMSIgY2xhc3M9ImVkZ2UiPgo8dGl0bGU+cGlubmVkX2JveDpjJiM0NTsmZ3Q7cGluPC90aXRsZT4KPHBhdGggZmlsbD0ibm9uZSIgc3Ryb2tlPSJibGFjayIgZD0iTTI4LC05Ny43NUMyOCwtOTcuNzUgODUuMTUsLTk3Ljk2IDk0LjA4LC05OCIvPgo8L2c+CjwhLS0gYm94IC0tPgo8ZyBpZD0ibm9kZTMiIGNsYXNzPSJub2RlIj4KPHRpdGxlPmJveDwvdGl0bGU+Cjxwb2x5bGluZSBmaWxsPSJub25lIiBzdHJva2U9ImJsYWNrIiBwb2ludHM9IjE1NiwtMTA5Ljc1IDE3NywtMTA5Ljc1Ii8+Cjx0ZXh0IHRleHQtYW5jaG9yPSJzdGFydCIgeD0iMTU5IiB5PSItMTE1Ljk1IiBmb250LWZhbWlseT0iVGltZXMsc2VyaWYiIGZvbnQtc2l6ZT0iMTQuMDAiPmZ1dDwvdGV4dD4KPHBvbHlnb24gZmlsbD0ibm9uZSIgc3Ryb2tlPSJibGFjayIgcG9pbnRzPSIxNTYsLTg3LjI1IDE1NiwtMTA5Ljc1IDE3NywtMTA5Ljc1IDE3NywtODcuMjUgMTU2LC04Ny4yNSIvPgo8dGV4dCB0ZXh0LWFuY2hvcj0ic3RhcnQiIHg9IjE2My4xMiIgeT0iLTkzLjQ1IiBmb250LWZhbWlseT0iVGltZXMsc2VyaWYiIGZvbnQtc2l6ZT0iMTQuMDAiPjA8L3RleHQ+Cjxwb2x5Z29uIGZpbGw9Im5vbmUiIHN0cm9rZT0iYmxhY2siIHBvaW50cz0iMTU2LC02NC43NSAxNTYsLTg3LjI1IDE3NywtODcuMjUgMTc3LC02NC43NSAxNTYsLTY0Ljc1Ii8+Cjx0ZXh0IHRleHQtYW5jaG9yPSJzdGFydCIgeD0iMTY0LjYyIiB5PSItNzAuOTUiIGZvbnQtZmFtaWx5PSJUaW1lcyxzZXJpZiIgZm9udC1zaXplPSIxNC4wMCI+IDwvdGV4dD4KPHBvbHlnb24gZmlsbD0ibm9uZSIgc3Ryb2tlPSJibGFjayIgc3Ryb2tlLWRhc2hhcnJheT0iNSwyIiBwb2ludHM9IjE1NiwtNDIuMjUgMTU2LC02NC43NSAxNzcsLTY0Ljc1IDE3NywtNDIuMjUgMTU2LC00Mi4yNSIvPgo8dGV4dCB0ZXh0LWFuY2hvcj0ic3RhcnQiIHg9IjE2MC44OCIgeT0iLTQ4LjQ1IiBmb250LWZhbWlseT0iVGltZXMsc2VyaWYiIGZvbnQtc2l6ZT0iMTQuMDAiPi4uLjwvdGV4dD4KPHBvbHlnb24gZmlsbD0ibm9uZSIgc3Ryb2tlPSJibGFjayIgcG9pbnRzPSIxNTYsLTE5Ljc1IDE1NiwtNDIuMjUgMTc3LC00Mi4yNSAxNzcsLTE5Ljc1IDE1NiwtMTkuNzUiLz4KPHRleHQgdGV4dC1hbmNob3I9InN0YXJ0IiB4PSIxNjMuMTIiIHk9Ii0yNS45NSIgZm9udC1mYW1pbHk9IlRpbWVzLHNlcmlmIiBmb250LXNpemU9IjE0LjAwIj4xPC90ZXh0Pgo8L2c+CjwhLS0gcGluJiM0NTsmZ3Q7Ym94IC0tPgo8ZyBpZD0iZWRnZTIiIGNsYXNzPSJlZGdlIj4KPHRpdGxlPnBpbiYjNDU7Jmd0O2JveDp0YXJnZXQ8L3RpdGxlPgo8cGF0aCBmaWxsPSJub25lIiBzdHJva2U9ImJsYWNrIiBkPSJNOTcuMjUsLTk4Qzk3LjI1LC05OCAxMjAuNzMsLTk4LjM3IDE0My41OCwtOTguNDciLz4KPHBvbHlnb24gZmlsbD0iYmxhY2siIHN0cm9rZT0iYmxhY2siIHBvaW50cz0iMTQzLjQ4LC0xMDEuOTcgMTUzLjQ5LC05OC41IDE0My41LC05NC45NyAxNDMuNDgsLTEwMS45NyIvPgo8L2c+CjwhLS0gYm94JiM0NTsmZ3Q7Ym94IC0tPgo8ZyBpZD0iZWRnZTMiIGNsYXNzPSJlZGdlIj4KPHRpdGxlPmJveDpjJiM0NTsmZ3Q7Ym94OmludGVybmFsPC90aXRsZT4KPHBhdGggZmlsbD0ibm9uZSIgc3Ryb2tlPSJibGFjayIgZD0iTTE2Ni41LC03NkMxNDUuNzksLTg1IDEwNC4zOCwtODUgMTA0LjM4LC01My41IDEwNC4zOCwtMzEuMDggMTI1LjM2LC0yNC42MiAxNDQuOTMsLTI2Ii8+Cjxwb2x5Z29uIGZpbGw9ImJsYWNrIiBzdHJva2U9ImJsYWNrIiBwb2ludHM9IjE0NC4yMSwtMjkuNDMgMTU0LjYyLC0yNy40NCAxNDUuMjQsLTIyLjUxIDE0NC4yMSwtMjkuNDMiLz4KPC9nPgo8L2c+Cjwvc3ZnPgo=" class="center"><figcaption>图 17-6: pin 住一个指向自引用 future 类型的 `Box`。</figcaption></figure><p>事实上，<code>Box</code> 指针仍然可以随意移动。请记住：我们关心确保最终被引用的数据保持不动。如果指针移动了，<strong>但是它指向的数据还在相同的位置</strong>，就像图 17-7 一样，就不会有潜在的问题。（作为一个独立的练习，查看一下 <code>Pin</code> 类型以及 <code>std::pin</code> 模块的文档来尝试理解如何通过 <code>Pin</code> 封装一个 <code>Box</code> 来做到这些。）其关键在于自引用类型本身不可移动，因为它仍然是被 pin 住的。</p><figure><img alt="Four boxes laid out in three rough columns, identical to the previous diagram with a change to the second column. Now there are two boxes in the second column, labeled “b1” and “b2”, “b1” is grayed out, and the arrow from “Pin” goes through “b2” instead of “b1”, indicating that the pointer has moved from “b1” to “b2”, but the data in “pinned” has not moved." src="/trpl-zh-cn/assets/trpl17-07-DpoE-4Fe.svg" class="center"><figcaption>图 17-7: 移动一个指向自引用 future 类型的 `Box`。</figcaption></figure></div><!--[--><div class="backlink-container" data-v-dd26a662><div class="backlink-header" data-v-dd26a662><span data-v-dd26a662>链接到当前文件 </span><span data-v-dd26a662>1</span></div><div data-v-dd26a662><!--[--><div class="backlink-item" data-v-dd26a662><a href="/trpl-zh-cn/trpl-zh-cn/SUMMARY.html" class="" data-v-dd26a662>SUMMARY</a></div><!--]--></div></div><!--]--><footer class="vp-page-meta"><div class="vp-meta-item edit-link"><a class="auto-link external-link vp-meta-label" href="https://github.com/LincDocs/trpl-zh-cn/edit/main/src/ch17-05-traits-for-async.md" aria-label="在 GitHub 上编辑此页" rel="noopener noreferrer" target="_blank" iconsizing="both"><!--[--><svg xmlns="http://www.w3.org/2000/svg" class="icon edit-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="edit icon" name="edit"><path d="M430.818 653.65a60.46 60.46 0 0 1-50.96-93.281l71.69-114.012 7.773-10.365L816.038 80.138A60.46 60.46 0 0 1 859.225 62a60.46 60.46 0 0 1 43.186 18.138l43.186 43.186a60.46 60.46 0 0 1 0 86.373L588.879 565.55l-8.637 8.637-117.466 68.234a60.46 60.46 0 0 1-31.958 11.229z"></path><path d="M728.802 962H252.891A190.883 190.883 0 0 1 62.008 771.98V296.934a190.883 190.883 0 0 1 190.883-192.61h267.754a60.46 60.46 0 0 1 0 120.92H252.891a69.962 69.962 0 0 0-69.098 69.099V771.98a69.962 69.962 0 0 0 69.098 69.098h475.911A69.962 69.962 0 0 0 797.9 771.98V503.363a60.46 60.46 0 1 1 120.922 0V771.98A190.883 190.883 0 0 1 728.802 962z"></path></svg><!--]-->在 GitHub 上编辑此页<!----></a></div><div class="vp-meta-item git-info"><!----><!----></div></footer><nav class="vp-page-nav"><a class="route-link auto-link prev" href="/trpl-zh-cn/ch17-04-streams.html" aria-label="/ch17-04-streams.html" iconsizing="both"><div class="hint"><span class="arrow start"></span>上一页</div><div class="link"><!---->/ch17-04-streams.html</div></a><a class="route-link auto-link next" href="/trpl-zh-cn/ch17-06-futures-tasks-threads.html" aria-label="/ch17-06-futures-tasks-threads.html" iconsizing="both"><div class="hint">下一页<span class="arrow end"></span></div><div class="link">/ch17-06-futures-tasks-threads.html<!----></div></a></nav><!----><!----><!--]--></main><!--]--><footer class="vp-footer-wrapper" vp-footer><div class="vp-footer">Powered by <a href="https://github.com/LincDocs/Workflow">LincZero.github.io Workflow</a></div><!----></footer></div><!--]--><!--]--><!--[--><!----><!----><!--[--><!--]--><!--]--><!--]--></div>
    <script type="module" src="/trpl-zh-cn/assets/app-oyO3eSzo.js" defer></script>
  </body>
</html>
